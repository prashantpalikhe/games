<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />

    <!-- iOS / PWA Setup -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Flag Master" />
    <meta name="theme-color" content="#ffffff" />

    <link rel="icon" type="image/png" href="/flag/icon.png" />
    <link rel="apple-touch-icon" href="/flag/icon.png" />

    <!-- Google Fonts: Nunito -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet" />

    <title>Flag Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Nunito", "system-ui", "sans-serif"],
            },
            animation: {
              "bounce-custom-small": "bounce-custom-small 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards",
              "fade-in": "fade-in 0.3s ease-out forwards",
            },
            keyframes: {
              "bounce-custom-small": {
                "0%": { transform: "scale(0.9)", opacity: 0 },
                "100%": { transform: "scale(1)", opacity: 1 },
              },
              "fade-in": {
                "0%": { opacity: 0 },
                "100%": { opacity: 1 },
              },
            },
          },
        },
      };
    </script>
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

    <style>
      /* Force full height and background for iOS status bar area */
      :root {
        --safe-top: env(safe-area-inset-top, 20px);
      }

      html {
        height: 100%;
        background-color: #ffffff;
        padding: 0;
        margin: 0;
      }

      body {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
        background-color: #ffffff;
        /* Extend background to status bar */
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }

      /* Hide content until Vue app is ready */
      [v-cloak] {
        display: none !important;
      }

      /* Custom utilities for animations */
      @keyframes bounce-custom {
        0%,
        100% {
          transform: translateY(-10%);
          animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
        }
        50% {
          transform: translateY(0);
          animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
        }
      }
      .animate-bounce-custom {
        animation: bounce-custom 1s infinite;
      }

      /* Safe area for notch */
      .safe-top {
        padding-top: var(--safe-top);
      }

      /* Smooth transitions for the bottom sheet */
      .sheet-transition {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Prevent highlighting text on rapid clicks */
      .no-select {
        -webkit-tap-highlight-color: transparent;
        user-select: none;
      }

      /* Disable touch actions for zoom and bounce */
      html,
      body {
        touch-action: manipulation;
        overscroll-behavior: none;
      }

      /* Fade transition for screens */
      .fade-enter-active,
      .fade-leave-active {
        transition: opacity 0.3s ease;
      }

      .fade-enter-from,
      .fade-leave-to {
        opacity: 0;
      }

      /* Animated Background */
      @keyframes gradient-bg {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      .animate-gradient {
        background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
        background-size: 400% 400%;
        animation: gradient-bg 15s ease infinite;
      }

      /* Floating Points */
      @keyframes float-up {
        0% {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
        100% {
          transform: translateY(-60px) scale(1.2);
          opacity: 0;
        }
      }
      .float-points {
        position: absolute;
        font-weight: 900;
        color: #facc15; /* Yellow-400 */
        -webkit-text-stroke: 1px #b45309; /* Amber-700 outline */
        text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.2);
        pointer-events: none;
        animation: float-up 1s ease-out forwards;
        z-index: 100;
        font-size: 2.5rem;
        font-family: system-ui, -apple-system, sans-serif;
      }

      /* Screen Shake */
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        10%,
        30%,
        50%,
        70%,
        90% {
          transform: translateX(-5px);
        }
        20%,
        40%,
        60%,
        80% {
          transform: translateX(5px);
        }
      }
      .animate-shake {
        animation: shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
      }

      /* Custom scrollbar for modals */
      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #d1d5db;
        border-radius: 3px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #9ca3af;
      }

      /* Mindfuck Mode Effects */
      .mf-invert {
        filter: invert(1);
      }
      .mf-grayscale {
        filter: grayscale(1);
      }
      .mf-blur {
        filter: blur(4px);
      }
      .mf-flip-v {
        transform: scaleY(-1);
      }
      .mf-flip-h {
        transform: scaleX(-1);
      }
      .mf-spin {
        animation: spin-flag 3s linear infinite;
      }
      .mf-skew {
        transform: skew(20deg, 10deg);
      }

      @keyframes spin-flag {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      native-sheet.mistakes-sheet {
        --native-sheet-bg: #f8fafc;
        --native-sheet-content-padding: 24px 24px 40px;
      }
    </style>
    <script>
      const NATIVE_SHEET_CSS = `
        :host {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            visibility: hidden;
            transition: visibility 0.3s;
            display: flex;
            flex-direction: column;
        }

        :host([open]) {
            visibility: visible;
        }

        .backdrop {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--native-sheet-backdrop, rgba(0,0,0,1));
            opacity: 0;
            will-change: opacity;
            pointer-events: none;
            transition: opacity 0.1s ease-out;
        }

        :host([open]) .backdrop {
            pointer-events: auto;
        }

        .scroll-wrapper {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
            scroll-behavior: smooth;
            overscroll-behavior: contain;
            display: flex;
            flex-direction: column;
        }


        .scroll-wrapper::-webkit-scrollbar { display: none; }

        .shim {
            min-height: 100vh;
            width: 100%;
            scroll-snap-align: start;
            flex-shrink: 0;
            pointer-events: none;
        }

        .sheet {
            background: var(--native-sheet-bg, #fff);
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            width: 100%;
            scroll-snap-align: end;
            scroll-snap-stop: always;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.1);
            position: relative;
            pointer-events: auto;
        }

        .sheet::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            height: 100vh;
            background: inherit;
        }

        .content {
            position: relative;
            padding: var(--native-sheet-content-padding, 12px 24px 40px);
        }
      `;

      class NativeSheet extends HTMLElement {
        constructor() {
          super();
          this.attachShadow({ mode: "open" });
          this._isOpen = false;
        }

        connectedCallback() {
          this.render();
          this.scrollWrapper = this.shadowRoot.querySelector(".scroll-wrapper");
          this.backdrop = this.shadowRoot.querySelector(".backdrop");
          this.shim = this.shadowRoot.querySelector(".shim");
          this.sheet = this.shadowRoot.querySelector(".sheet");

          this.observer = new IntersectionObserver(
            (entries) => {
              entries.forEach((entry) => {
                if (entry.isIntersecting && entry.intersectionRatio > 0.9) {
                  if (this._isOpen) {
                    this.open = false;
                  }
                }
              });
            },
            { threshold: [0.9] }
          );

          this.observer.observe(this.shim);
          this.backdrop.addEventListener("click", () => (this.open = false));

          // Handle scroll-based backdrop opacity with requestAnimationFrame for performance
          this._scrollRaf = null;
          this.handleScroll = () => {
            if (this._scrollRaf) return;
            this._scrollRaf = requestAnimationFrame(() => {
              if (!this._isOpen) {
                this._scrollRaf = null;
                return;
              }
              const shimHeight = this.shim.offsetHeight;
              const scrollTop = this.scrollWrapper.scrollTop;
              // When scrollTop is at shimHeight, backdrop opacity is 0.7
              // When scrollTop is 0 (pulled down), backdrop is invisible (opacity 0)
              const progress = Math.max(0, Math.min(1, scrollTop / shimHeight));
              this.backdrop.style.opacity = (progress * 0.7).toString();
              this._scrollRaf = null;
            });
          };

          this.scrollWrapper.addEventListener("scroll", this.handleScroll, { passive: true });
        }

        disconnectedCallback() {
          if (this.observer && this.shim) {
            this.observer.unobserve(this.shim);
          }
          if (this.scrollWrapper && this.handleScroll) {
            this.scrollWrapper.removeEventListener("scroll", this.handleScroll);
          }
          if (this._scrollRaf) {
            cancelAnimationFrame(this._scrollRaf);
          }
        }

        static get observedAttributes() {
          return ["open"];
        }

        attributeChangedCallback(name, oldValue, newValue) {
          if (name === "open") {
            const isOpen = newValue !== null;
            if (this._isOpen !== isOpen) {
              this._isOpen = isOpen;
              this.triggerAnimation(isOpen);
              this.dispatchEvent(
                new CustomEvent("native-sheet-toggle", {
                  detail: { open: this._isOpen },
                  bubbles: true,
                  composed: true,
                })
              );
            }
          }
        }

        get open() {
          return this.hasAttribute("open");
        }
        set open(val) {
          if (val) this.setAttribute("open", "");
          else this.removeAttribute("open");
        }

        triggerAnimation(isOpen) {
          if (isOpen) {
            this.scrollWrapper.style.scrollBehavior = "smooth";
            this.scrollWrapper.scrollTop = 0;
            this.backdrop.style.opacity = "0";

            requestAnimationFrame(() => {
              this.scrollWrapper.style.scrollBehavior = "smooth";
              this.scrollWrapper.scrollTop = this.shim.offsetHeight;
              // Update opacity immediately and after scroll completes
              this.handleScroll();
              setTimeout(() => {
                this.handleScroll();
              }, 350);
            });
          } else {
            this.scrollWrapper.style.scrollBehavior = "smooth";
            this.scrollWrapper.scrollTop = 0;
            this.backdrop.style.opacity = "0";
          }
        }

        render() {
          this.shadowRoot.innerHTML = `
            <style>${NATIVE_SHEET_CSS}</style>
            <div class="backdrop"></div>
            <div class="scroll-wrapper">
                <div class="shim"></div>
                <div class="sheet">
                    <div class="content">
                        <slot></slot>
                    </div>
                </div>
            </div>
          `;
        }
      }

      customElements.define("native-sheet", NativeSheet);
    </script>
  </head>
  <body class="bg-gray-100 text-gray-800 font-sans overflow-hidden flex justify-center items-center animate-gradient">
    <!-- App Container -->
    <div
      id="app"
      v-cloak
      :class="{'animate-shake': shakeActive}"
      class="w-full max-w-md h-full max-h-[900px] bg-white shadow-2xl relative overflow-hidden flex flex-col md:rounded-xl md:h-[90vh] md:mt-0 transition-transform"
    >
      <!-- Floating Points Container -->
      <div class="absolute inset-0 pointer-events-none overflow-hidden z-50">
        <div
          v-for="point in floatingPoints"
          :key="point.id"
          class="float-points"
          :style="{ left: point.x + 'px', top: point.y + 'px' }"
        >
          +{{ point.amount }}
        </div>
      </div>

      <!-- Fireworks Container -->
      <div ref="fireworksContainer" class="absolute inset-0 pointer-events-none z-40"></div>

      <!-- Region Selector Sheet -->
      <native-sheet
        :open="showRegionSelector ? '' : null"
        @native-sheet-toggle="showRegionSelector = $event.detail.open"
      >
        <div class="flex justify-center py-4">
          <div class="w-12 h-1.5 bg-gray-300 rounded-full"></div>
        </div>
        <div class="w-full max-w-md mx-auto space-y-6">
          <div class="flex justify-between items-center">
            <h3 class="text-2xl font-bold text-gray-800">Select Region</h3>
            <button
              @click="showRegionSelector = false"
              class="text-gray-400 hover:text-gray-600 bg-gray-100 rounded-full p-1"
              v-html="icons.x"
            ></button>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <button
              v-for="region in continents"
              :key="region"
              @click="selectedRegion = region; showRegionSelector = false"
              class="py-3 px-4 rounded-xl font-bold text-left transition-all flex justify-between items-center border-2"
              :class="selectedRegion === region ? 'bg-blue-50 border-blue-500 text-blue-700' : 'bg-white border-gray-200 text-gray-600 hover:bg-gray-50'"
            >
              <span>{{ region }}</span>
              <span v-if="selectedRegion === region" v-html="icons.check" class="text-blue-500 scale-75"></span>
            </button>
          </div>
        </div>
      </native-sheet>

      <!-- Settings Sheet -->
      <native-sheet :open="showSettings ? '' : null" @native-sheet-toggle="showSettings = $event.detail.open">
        <div class="flex justify-center py-4">
          <div class="w-12 h-1.5 bg-gray-300 rounded-full"></div>
        </div>
        <div class="w-full max-w-md mx-auto space-y-6">
          <div class="flex justify-between items-center">
            <h3 class="text-2xl font-bold text-gray-800">Settings</h3>
            <button
              @click="showSettings = false"
              class="text-gray-400 hover:text-gray-600 bg-gray-100 rounded-full p-1"
              v-html="icons.x"
            ></button>
          </div>
          <div class="flex flex-col space-y-4">
            <button
              @click="soundEnabled = !soundEnabled"
              class="py-4 px-4 rounded-xl font-bold text-left transition-all flex justify-between items-center border-2"
              :class="soundEnabled ? 'bg-blue-50 border-blue-500 text-blue-700' : 'bg-white border-gray-200 text-gray-600'"
            >
              <div class="flex items-center space-x-3">
                <span v-html="soundEnabled ? icons.volume : icons.volumeOff"></span>
                <span>Sound Effects</span>
              </div>
              <div
                class="w-12 h-6 rounded-full relative transition-colors duration-200"
                :class="soundEnabled ? 'bg-blue-500' : 'bg-gray-300'"
              >
                <div
                  class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform duration-200"
                  :class="soundEnabled ? 'translate-x-6' : 'translate-x-0'"
                ></div>
              </div>
            </button>
            <button
              @click="autoContinue = !autoContinue"
              class="py-4 px-4 rounded-xl font-bold text-left transition-all flex justify-between items-center border-2"
              :class="autoContinue ? 'bg-blue-50 border-blue-500 text-blue-700' : 'bg-white border-gray-200 text-gray-600'"
            >
              <div class="flex items-center space-x-3">
                <span v-html="autoContinue ? icons.play : icons.pause"></span>
                <span>Auto-Continue (Correct Answers)</span>
              </div>
              <div
                class="w-12 h-6 rounded-full relative transition-colors duration-200"
                :class="autoContinue ? 'bg-blue-500' : 'bg-gray-300'"
              >
                <div
                  class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform duration-200"
                  :class="autoContinue ? 'translate-x-6' : 'translate-x-0'"
                ></div>
              </div>
            </button>
          </div>
        </div>
      </native-sheet>

      <!-- Mistakes Sheet -->
      <native-sheet
        class="mistakes-sheet"
        :open="showMistakesModal ? '' : null"
        @native-sheet-toggle="showMistakesModal = $event.detail.open"
      >
        <div class="flex justify-center py-4">
          <div class="w-12 h-1.5 bg-gray-300 rounded-full"></div>
        </div>
        <div class="w-full max-w-md mx-auto flex flex-col space-y-4">
          <div class="flex justify-between items-center">
            <h3 class="text-2xl font-bold text-gray-800">Your Mistakes</h3>
            <button
              @click="showMistakesModal = false"
              class="text-gray-400 hover:text-gray-600 bg-gray-100 rounded-full p-1"
              v-html="icons.x"
            ></button>
          </div>

          <div class="overflow-y-auto max-h-[60vh] pr-2 -mr-2 custom-scrollbar">
            <div class="space-y-4 pb-4">
              <div
                v-for="(item, idx) in wrongAnswers"
                :key="idx"
                class="bg-gray-50 rounded-xl p-4 border border-gray-200 flex flex-col"
              >
                <div class="flex items-start space-x-4 mb-3">
                  <img
                    :src="`https://flagcdn.com/w160/${item.question.correctOption.code}.png`"
                    class="w-20 h-auto object-cover rounded shadow-sm border border-gray-200"
                    loading="lazy"
                  />
                  <div>
                    <div class="text-xs text-gray-400 font-bold uppercase mb-0.5">Correct Answer</div>
                    <div class="text-lg font-extrabold text-gray-800 leading-tight">
                      {{ gameMode === 'capitals' ? item.question.correctOption.capital :
                      item.question.correctOption.name }}
                    </div>
                  </div>
                </div>

                <div class="w-full bg-red-50 rounded-lg p-2 flex items-center border border-red-100">
                  <div class="mr-2 bg-red-100 text-red-500 rounded-full p-1">
                    <span class="w-6 h-6 block" v-html="icons.x"></span>
                  </div>
                  <div>
                    <div class="text-[10px] text-red-400 font-bold uppercase leading-none mb-0.5">You Answered</div>
                    <div class="text-sm font-bold text-red-600 leading-tight">
                      <span v-if="item.type === 'timeout'">Time's Up!</span>
                      <span v-else-if="typeof item.userAnswer === 'string'"> "{{ item.userAnswer }}" </span>
                      <span v-else-if="item.userAnswer">
                        {{ gameMode === 'capitals' ? item.userAnswer.capital : item.userAnswer.name }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="pt-2 border-t border-gray-100">
            <button
              @click="showMistakesModal = false"
              class="w-full py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold rounded-xl transition-colors"
            >
              Close
            </button>
          </div>
        </div>
      </native-sheet>

      <!-- START SCREEN -->
      <div
        v-if="screen === 'start'"
        class="flex flex-col items-center justify-center h-full p-6 text-center animate-fade-in relative"
      >
        <!-- Settings Button -->
        <button
          @click="showSettings = true"
          class="absolute right-4 p-2 bg-white border border-gray-200 hover:bg-gray-50 rounded-full text-gray-500 hover:text-gray-700 transition-colors shadow-sm"
          style="top: calc(1rem + env(safe-area-inset-top, 20px))"
        >
          <span v-html="icons.gear"></span>
        </button>

        <div class="mb-8 animate-bounce-custom">
          <div
            class="w-32 h-24 bg-blue-500 rounded-lg shadow-lg flex items-center justify-center relative overflow-hidden border-4 border-blue-700 transform rotate-3"
          >
            <div class="absolute inset-0 flex flex-col">
              <div class="h-1/3 bg-yellow-400"></div>
              <div class="h-1/3 bg-blue-500"></div>
              <div class="h-1/3 bg-red-500"></div>
            </div>
          </div>
        </div>
        <h1 class="text-4xl font-extrabold text-gray-800 mb-4">Flag Master</h1>
        <p class="text-gray-500 text-lg mb-8 max-w-md">
          Master all {{ totalCountries }} flags of the world in one endless run!
        </p>

        <div
          v-if="highScore > 0"
          class="mb-8 bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full font-bold inline-flex items-center shadow-sm"
        >
          <span class="mr-2" v-html="icons.trophy"></span>
          Best Score: {{ highScore }}
        </div>

        <!-- Region Selector -->
        <button
          @click="showRegionSelector = true"
          class="mb-6 px-5 py-2 bg-white border-2 border-gray-200 rounded-full text-gray-700 font-bold flex items-center shadow-sm hover:bg-gray-50 transition-colors no-select"
        >
          <span class="mr-2 text-blue-500" v-html="icons.globe"></span>
          Region: {{ selectedRegion }}
        </button>

        <!-- Game Modes Carousel -->
        <div class="w-full overflow-x-auto pb-4 px-4 -mx-4 flex space-x-4 snap-x snap-mandatory no-scrollbar">
          <div
            v-for="mode in gameModes"
            :key="mode.id"
            @click="initGame(mode.id)"
            class="flex-shrink-0 w-40 h-48 rounded-2xl p-4 flex flex-col items-center justify-between border-b-4 active:border-b-0 active:translate-y-1 transition-all shadow-md snap-center relative overflow-hidden cursor-pointer no-select"
            :class="{
                        'bg-green-500 border-green-700 hover:bg-green-600': mode.color === 'green',
                        'bg-purple-500 border-purple-700 hover:bg-purple-600': mode.color === 'purple',
                        'bg-red-500 border-red-700 hover:bg-red-600': mode.color === 'red',
                        'bg-blue-500 border-blue-700 hover:bg-blue-600': mode.color === 'blue',
                        'bg-pink-500 border-pink-700 hover:bg-pink-600': mode.color === 'pink'
                    }"
          >
            <div class="text-white opacity-90 transform scale-125 mt-4" v-html="mode.icon"></div>

            <div class="text-center text-white">
              <div class="text-xl font-black uppercase tracking-wide mb-1">{{ mode.name }}</div>
              <div class="text-xs font-medium opacity-90 leading-tight">{{ mode.description }}</div>
            </div>

            <div class="w-8 h-1 bg-white/30 rounded-full mb-2"></div>
          </div>
        </div>

        <button
          @click="screen = 'passport'"
          class="mt-6 text-blue-500 font-bold flex items-center space-x-2 px-4 py-2 rounded-full hover:bg-blue-50 transition-colors"
        >
          <span v-html="icons.book"></span>
          <span>My Passport</span>
        </button>
      </div>

      <!-- PASSPORT SCREEN -->
      <div v-if="screen === 'passport'" class="flex flex-col h-full bg-gray-50">
        <div class="bg-white shadow-sm px-4 py-4 z-10 flex items-center justify-between safe-top">
          <div class="flex items-center space-x-3">
            <button
              @click="screen = 'start'"
              class="text-gray-500 hover:text-gray-700 bg-gray-100 p-2 rounded-full transition-colors"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M19 12H5" />
                <path d="M12 19l-7-7 7-7" />
              </svg>
            </button>
            <h2 class="text-xl font-bold text-gray-800">My Passport</h2>
          </div>
          <div class="text-sm font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-full">
            {{ Object.keys(collectedFlags).length }} / {{ totalCountries }}
          </div>
        </div>

        <div class="flex-1 overflow-y-auto p-4">
          <!-- Region Stats -->
          <div class="grid grid-cols-2 gap-2 mb-6">
            <div
              class="bg-white p-3 rounded-xl border border-gray-100 shadow-sm flex flex-col items-center justify-center"
              v-for="region in continents.filter(c => c !== 'World')"
              :key="region"
            >
              <span class="text-xs text-gray-400 font-bold uppercase tracking-wider mb-1">{{ region }}</span>
              <span
                class="text-lg font-extrabold"
                :class="getRegionProgress(region) === 100 ? 'text-green-500' : 'text-gray-700'"
              >
                {{ getRegionCount(region) }}%
              </span>
              <div class="w-full h-1.5 bg-gray-100 rounded-full mt-2 overflow-hidden">
                <div class="h-full bg-green-500 rounded-full" :style="{ width: getRegionProgress(region) + '%' }"></div>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-4 gap-3 pb-8">
            <div
              v-for="country in COUNTRIES"
              :key="country.code"
              class="aspect-square rounded-xl flex items-center justify-center relative overflow-hidden border-2 transition-all"
              :class="collectedFlags[country.code] ? 'bg-white border-blue-200 shadow-sm' : 'bg-gray-100 border-gray-200 opacity-60'"
            >
              <img
                v-if="collectedFlags[country.code]"
                :src="`https://flagcdn.com/w160/${country.code}.png`"
                loading="lazy"
                class="w-full h-full object-cover"
                :alt="country.name"
              />
              <span v-else class="text-2xl text-gray-300">?</span>

              <!-- Count Badge -->
              <div
                v-if="collectedFlags[country.code] > 1"
                class="absolute bottom-0 right-0 bg-blue-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-tl-lg"
              >
                {{ collectedFlags[country.code] }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- PLAYING SCREEN -->
      <div v-if="screen === 'playing'" class="flex flex-col h-full relative">
        <!-- Header -->
        <div class="pt-6 pb-6 px-4 flex flex-col bg-white z-10 safe-top">
          <div class="flex items-center justify-between w-full">
            <button @click="quitGame" class="text-gray-400 hover:text-gray-600 no-select" v-html="icons.x"></button>

            <div class="flex-1 mx-4 flex items-center space-x-3">
              <!-- Progress Bar Container -->
              <div class="flex-1 relative h-4">
                <!-- Track -->
                <div class="absolute inset-0 bg-gray-200 rounded-full overflow-hidden border border-gray-300/50">
                  <div
                    class="h-full transition-all duration-500 ease-out rounded-full shadow-[0_0_10px_rgba(0,0,0,0.1)]"
                    :class="progressBarClass"
                    :style="{ width: progress + '%' }"
                  ></div>
                </div>
              </div>

              <div class="text-sm font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded-md min-w-[60px] text-center">
                {{ score }}
              </div>
            </div>

            <div class="flex items-center space-x-1">
              <span v-html="lives > 0 ? icons.heartFilled : icons.heart"></span>
              <span class="text-xl font-bold text-red-500">{{ lives }}</span>
            </div>
          </div>

          <!-- Blitz Timer -->
          <div v-if="gameMode === 'blitz'" class="w-full mt-3">
            <div class="w-full h-3 bg-gray-200 rounded-full overflow-hidden shadow-inner">
              <div
                class="h-full transition-all duration-100 ease-linear"
                :class="timeLeft < 2 ? 'bg-red-600 animate-pulse' : 'bg-orange-500'"
                :style="{ width: (timeLeft / 5) * 100 + '%' }"
              ></div>
            </div>
          </div>
        </div>

        <!-- Game Board -->
        <div class="flex-1 overflow-y-auto p-4 flex flex-col items-center w-full pb-32">
          <h2 class="text-2xl font-bold text-gray-700 mt-4 mb-6 text-left w-full">
            {{ gameMode === 'reverse' ? 'Which flag is this?' : (gameMode === 'capitals' ? 'What is the capital?' :
            (gameMode === 'description' ? 'Which country has this flag?' : 'Which country is this?')) }}
          </h2>

          <div
            class="mb-6 p-4 bg-white rounded-2xl shadow-sm border-2 border-gray-100 w-full flex flex-col justify-center items-center min-h-[160px]"
          >
            <img
              v-if="currentQuestion && gameMode !== 'reverse' && gameMode !== 'description'"
              :src="`https://flagcdn.com/w640/${currentQuestion.correctOption.code}.png`"
              alt="Flag"
              class="h-40 w-auto rounded-md shadow-md object-cover border border-gray-200"
              :class="[currentEffect, { 'transition-all duration-500': feedback !== null }]"
              @error="handleImageError"
            />
            <h3
              v-if="currentQuestion && gameMode === 'reverse'"
              class="text-3xl font-extrabold text-gray-800 text-center mt-2"
            >
              {{ currentQuestion.correctOption.name }}
            </h3>
            <div v-if="currentQuestion && gameMode === 'description'" class="text-center px-2">
              <div class="text-xl font-bold text-gray-600 mb-2">üìñ Flag Description:</div>
              <p class="text-lg text-gray-800 leading-relaxed">{{ currentQuestion.correctOption.description }}</p>
            </div>
          </div>

          <!-- Input for Hard Mode -->
          <div v-if="gameMode === 'hard'" class="w-full px-4">
            <form @submit.prevent="handleAnswer(userAnswer)" class="flex flex-col space-y-4">
              <input
                type="text"
                v-model="userAnswer"
                placeholder="Type country name..."
                class="w-full p-4 rounded-xl border-2 border-gray-200 text-lg font-bold text-center focus:outline-none focus:border-blue-500 transition-colors"
                :class="{'border-green-500 bg-green-50 text-green-700': feedback === 'correct', 'border-red-500 bg-red-50 text-red-700': feedback === 'incorrect'}"
                :disabled="feedback !== null"
                autofocus
              />
              <button
                type="submit"
                class="w-full py-3 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-xl shadow-md active:translate-y-0.5 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                :disabled="!userAnswer || feedback !== null"
              >
                Submit Answer
              </button>
            </form>
          </div>

          <div
            class="grid w-full"
            :class="gameMode === 'reverse' ? 'grid-cols-2 gap-4' : 'grid-cols-1 gap-3'"
            v-else-if="currentQuestion"
          >
            <button
              v-for="(option, idx) in currentQuestion.options"
              :key="option.code"
              @click="handleAnswer(option, $event)"
              class="relative w-full rounded-2xl border-2 border-b-4 font-bold transition-all flex items-center justify-between group no-select"
              :class="[
                            getOptionClass(option),
                            gameMode === 'reverse' ? 'p-2 h-32 flex-col justify-center' : 'p-4 text-lg'
                        ]"
              :disabled="feedback !== null"
            >
              <div class="flex items-center" :class="{'w-full justify-center': gameMode === 'reverse'}">
                <span
                  class="flex items-center justify-center w-8 h-8 rounded-lg text-sm border absolute top-2 left-2"
                  :class="getNumberClass(option)"
                  v-if="gameMode === 'reverse'"
                >
                  {{ idx + 1 }}
                </span>
                <span
                  class="flex items-center justify-center w-8 h-8 rounded-lg text-sm border mr-3"
                  :class="getNumberClass(option)"
                  v-else
                >
                  {{ idx + 1 }}
                </span>

                <span v-if="gameMode !== 'reverse'">{{ gameMode === 'capitals' ? option.capital : option.name }}</span>
                <img
                  v-if="gameMode === 'reverse'"
                  :src="`https://flagcdn.com/w320/${option.code}.png`"
                  alt="Flag"
                  class="h-20 w-auto rounded shadow-sm object-cover"
                  @error="handleImageError"
                />
              </div>
            </button>
          </div>
        </div>

        <!-- Bottom Sheet -->
        <div
          class="fixed bottom-0 left-0 right-0 max-w-md mx-auto sheet-transition p-4 border-t-2 flex flex-col z-50 shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.3)]"
          :class="bottomSheetClasses"
        >
          <div class="flex items-center justify-between mb-4 px-2">
            <div class="flex items-center space-x-3">
              <div class="p-2 rounded-full text-white" :class="isCorrect ? 'bg-green-500' : 'bg-red-500'">
                <span v-html="isCorrect ? icons.check : icons.x"></span>
              </div>
              <div>
                <h3 class="text-xl font-extrabold" :class="isCorrect ? 'text-green-600' : 'text-red-600'">
                  {{ isCorrect ? 'Excellent!' : (feedback === 'timeout' ? "Time's Up!" : 'Incorrect') }}
                </h3>
                <p v-if="!isCorrect" class="text-red-500 font-medium">
                  Correct: {{ gameMode === 'capitals' ? currentQuestion?.correctOption.capital :
                  currentQuestion?.correctOption.name }}
                </p>
              </div>
            </div>
          </div>
          <button
            @click="nextQuestion"
            class="w-full py-3 px-6 rounded-xl font-bold text-white text-lg uppercase tracking-wider border-b-4 active:border-b-0 active:translate-y-1 transition-all shadow-md no-select"
            :class="isCorrect ? 'bg-green-500 hover:bg-green-600 border-green-700' : 'bg-red-500 hover:bg-red-600 border-red-700'"
          >
            Continue
          </button>
          <div class="h-4 md:h-0"></div>
        </div>

        <!-- Desktop Hint -->
        <div class="hidden md:block fixed bottom-4 right-4 text-xs text-gray-400 bg-white p-2 rounded border shadow-sm">
          Press <strong>1-4</strong> to answer, <strong>Enter</strong> to continue
        </div>
      </div>

      <!-- END SCREEN -->
      <div v-if="screen === 'end'" class="flex flex-col items-center justify-center h-full p-6 text-center">
        <div class="mb-6">
          <div class="w-32 h-32 mx-auto" :class="lives > 0 ? 'text-yellow-400' : 'text-gray-300'">
            <span v-html="lives > 0 ? icons.trophyLarge : icons.heartLarge"></span>
          </div>
        </div>

        <h2 class="text-3xl font-extrabold text-gray-800 mb-2">{{ lives > 0 ? 'World Master!' : 'Out of Hearts!' }}</h2>

        <div class="bg-gray-100 p-6 rounded-2xl w-full max-w-sm mb-8 border-2 border-gray-200">
          <div class="flex justify-between items-center mb-4 border-b pb-4 border-gray-300">
            <span class="text-gray-600 font-bold">Total Score</span>
            <span class="text-2xl font-extrabold text-blue-500">{{ score }}</span>
          </div>
          <div class="flex justify-between items-center mb-4 border-b pb-4 border-gray-300" v-if="highScore > 0">
            <span class="text-gray-600 font-bold">Best Score</span>
            <div class="flex items-center">
              <span
                v-if="score >= highScore && score > 0"
                class="mr-2 text-xs bg-yellow-400 text-white px-2 py-1 rounded-full font-bold animate-pulse"
                >NEW!</span
              >
              <span class="text-2xl font-extrabold text-yellow-600">{{ highScore }}</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-600 font-bold">Flags Identified</span>
            <span class="text-xl font-extrabold text-green-500">{{ currentIndex }}/{{ queue.length }}</span>
          </div>
        </div>

        <!-- Wrong Answers Button -->
        <button
          v-if="wrongAnswers.length > 0"
          @click="showMistakesModal = true"
          class="mb-6 px-6 py-3 bg-white border-2 border-red-100 rounded-xl text-red-500 font-bold flex items-center shadow-sm hover:bg-red-50 hover:border-red-200 transition-all w-full max-w-xs justify-center group"
        >
          <span class="mr-2 group-hover:scale-110 transition-transform">‚ö†Ô∏è</span>
          <span>Review {{ wrongAnswers.length }} Mistakes</span>
        </button>

        <button
          @click="screen = 'start'"
          class="w-full max-w-xs bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-8 rounded-2xl border-b-4 border-blue-700 active:border-b-0 active:translate-y-1 transition-all shadow-lg text-lg uppercase tracking-wide flex items-center justify-center space-x-2 no-select"
        >
          <span class="mr-2" v-html="icons.rotateCcw"></span>
          <span>Try Again</span>
        </button>

        <button
          @click="shareScore"
          class="mt-4 w-full max-w-xs bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-3 px-8 rounded-2xl border-b-4 border-yellow-600 active:border-b-0 active:translate-y-1 transition-all shadow-md text-lg uppercase tracking-wide flex items-center justify-center space-x-2 no-select"
        >
          <span class="mr-2" v-html="icons.share"></span>
          <span>Share Score</span>
        </button>
      </div>
    </div>

    <script>
      const { createApp, ref, computed, onMounted, onUnmounted } = Vue;
      debugger;
      // --- DATA ---
      const COUNTRIES = [
        {
          code: "ad",
          name: "Andorra",
          continent: "Europe",
          difficulty: "hard",
          description: "Vertical tricolor of blue, yellow, and red with a coat of arms in the center",
        },
        {
          code: "ae",
          name: "United Arab Emirates",
          continent: "Asia",
          difficulty: "medium",
          description: "Three horizontal stripes of green, white, and black with a vertical red band on the hoist side",
        },
        {
          code: "af",
          name: "Afghanistan",
          continent: "Asia",
          difficulty: "medium",
          description: "Vertical tricolor of black, red, and green with a white emblem in the center",
        },
        {
          code: "ag",
          name: "Antigua and Barbuda",
          continent: "North America",
          difficulty: "hard",
          description: "Red background with inverted V-shaped black, blue, and white bands, with a rising sun symbol",
        },
        {
          code: "al",
          name: "Albania",
          continent: "Europe",
          difficulty: "medium",
          description: "Red background with a black double-headed eagle in the center",
        },
        {
          code: "am",
          name: "Armenia",
          continent: "Asia",
          difficulty: "medium",
          description: "Three horizontal stripes of red, blue, and orange",
        },
        {
          code: "ao",
          name: "Angola",
          continent: "Africa",
          difficulty: "hard",
          description: "Horizontal red and black stripes with a yellow emblem featuring a machete, star, and gear",
        },
        {
          code: "ar",
          name: "Argentina",
          continent: "South America",
          difficulty: "easy",
          description: "Horizontal stripes of light blue, white, and light blue with a golden sun in the center",
        },
        {
          code: "at",
          name: "Austria",
          continent: "Europe",
          difficulty: "medium",
          description: "Three horizontal stripes of red, white, and red",
        },
        {
          code: "au",
          name: "Australia",
          continent: "Oceania",
          difficulty: "easy",
          description: "Blue background with Union Jack in the corner and white stars including the Southern Cross",
        },
        {
          code: "az",
          name: "Azerbaijan",
          continent: "Asia",
          difficulty: "medium",
          description: "Three horizontal stripes of blue, red, and green with a white crescent and star",
        },
        {
          code: "ba",
          name: "Bosnia and Herzegovina",
          continent: "Europe",
          difficulty: "hard",
          description: "Blue background with yellow diagonal band and white stars along the band",
        },
        {
          code: "bb",
          name: "Barbados",
          continent: "North America",
          difficulty: "medium",
          description: "Vertical stripes of blue, yellow, and blue with a black trident head in the center",
        },
        {
          code: "bd",
          name: "Bangladesh",
          continent: "Asia",
          difficulty: "medium",
          description: "Green background with a red circle slightly off-center to the hoist",
        },
        {
          code: "be",
          name: "Belgium",
          continent: "Europe",
          difficulty: "easy",
          description: "Vertical tricolor of black, yellow, and red",
        },
        {
          code: "bf",
          name: "Burkina Faso",
          continent: "Africa",
          difficulty: "hard",
          description: "Horizontal red and green stripes with a yellow star in the center",
        },
        {
          code: "bg",
          name: "Bulgaria",
          continent: "Europe",
          difficulty: "medium",
          description: "Three horizontal stripes of white, green, and red",
        },
        {
          code: "bh",
          name: "Bahrain",
          continent: "Asia",
          difficulty: "hard",
          description: "White and red divided by a serrated line with five triangular points",
        },
        {
          code: "bi",
          name: "Burundi",
          continent: "Africa",
          difficulty: "hard",
          description: "White X dividing red and green quarters with three red stars in a white circle at center",
        },
        {
          code: "bj",
          name: "Benin",
          continent: "Africa",
          difficulty: "hard",
          description: "Vertical green stripe on left, with yellow and red horizontal stripes on right",
        },
        {
          code: "bn",
          name: "Brunei",
          continent: "Asia",
          difficulty: "hard",
          description: "Yellow background with white and black diagonal stripes and a red crest in the center",
        },
        {
          code: "bo",
          name: "Bolivia",
          continent: "South America",
          difficulty: "medium",
          description: "Three horizontal stripes of red, yellow, and green with a coat of arms in the center",
        },
        {
          code: "br",
          name: "Brazil",
          continent: "South America",
          difficulty: "easy",
          description: "Green background with yellow diamond and blue circle containing white stars and a banner",
        },
        {
          code: "bs",
          name: "Bahamas",
          continent: "North America",
          difficulty: "medium",
          description:
            "Three horizontal stripes of aquamarine, yellow, and aquamarine with a black triangle on the hoist",
        },
        {
          code: "bt",
          name: "Bhutan",
          continent: "Asia",
          difficulty: "hard",
          description: "Diagonal orange and yellow halves with a white dragon in the center",
        },
        {
          code: "bw",
          name: "Botswana",
          continent: "Africa",
          difficulty: "medium",
          description: "Light blue background with a black horizontal stripe bordered by two thin white stripes",
        },
        {
          code: "by",
          name: "Belarus",
          continent: "Europe",
          difficulty: "medium",
          description: "Red and green horizontal stripes with an ornamental pattern on the hoist side",
        },
        {
          code: "bz",
          name: "Belize",
          continent: "North America",
          difficulty: "hard",
          description: "Blue background with red stripes on top and bottom edges and a circular emblem in the center",
        },
        {
          code: "ca",
          name: "Canada",
          continent: "North America",
          difficulty: "easy",
          description: "Red vertical stripes on the sides with a white center featuring a red maple leaf",
        },
        {
          code: "cd",
          name: "DR Congo",
          continent: "Africa",
          difficulty: "medium",
          description: "Light blue background with a yellow star and a red diagonal stripe bordered by yellow",
        },
        {
          code: "cf",
          name: "Central African Republic",
          continent: "Africa",
          difficulty: "hard",
          description:
            "Four horizontal stripes of blue, white, green, and yellow with a red vertical stripe and yellow star",
        },
        {
          code: "cg",
          name: "Congo",
          continent: "Africa",
          difficulty: "hard",
          description: "Diagonal green, yellow, and red stripes from corner to corner",
        },
        {
          code: "ch",
          name: "Switzerland",
          continent: "Europe",
          difficulty: "easy",
          description: "Red background with a white cross in the center",
        },
        {
          code: "ci",
          name: "Ivory Coast",
          continent: "Africa",
          difficulty: "hard",
          description: "Vertical tricolor of orange, white, and green",
        },
        {
          code: "cl",
          name: "Chile",
          continent: "South America",
          difficulty: "easy",
          description: "Blue square with white star in top left, white stripe on top, red stripe on bottom",
        },
        {
          code: "cm",
          name: "Cameroon",
          continent: "Africa",
          difficulty: "medium",
          description: "Vertical tricolor of green, red, and yellow with a yellow star in the center",
        },
        {
          code: "cn",
          name: "China",
          continent: "Asia",
          difficulty: "easy",
          description: "Red background with five yellow stars in the top left corner, one large and four small",
        },
        {
          code: "co",
          name: "Colombia",
          continent: "South America",
          difficulty: "medium",
          description: "Three horizontal stripes of yellow (half), blue, and red",
        },
        {
          code: "cr",
          name: "Costa Rica",
          continent: "North America",
          difficulty: "medium",
          description: "Five horizontal stripes of blue, white, red (wider), white, and blue",
        },
        {
          code: "cu",
          name: "Cuba",
          continent: "North America",
          difficulty: "medium",
          description:
            "Five horizontal stripes alternating blue and white with a red triangle and white star on the hoist",
        },
        {
          code: "cv",
          name: "Cape Verde",
          continent: "Africa",
          difficulty: "hard",
          description: "Blue background with white and red horizontal stripes and a circle of yellow stars",
        },
        {
          code: "cy",
          name: "Cyprus",
          continent: "Europe",
          difficulty: "medium",
          description: "White background with an orange silhouette of the island and olive branches below",
        },
        {
          code: "cz",
          name: "Czechia",
          continent: "Europe",
          difficulty: "medium",
          description: "White and red horizontal stripes with a blue triangle on the hoist side",
        },
        {
          code: "de",
          name: "Germany",
          continent: "Europe",
          difficulty: "easy",
          description: "Three horizontal stripes of black, red, and gold",
        },
        {
          code: "dj",
          name: "Djibouti",
          continent: "Africa",
          difficulty: "hard",
          description: "Horizontal light blue and light green stripes with a white triangle and red star on the hoist",
        },
        {
          code: "dk",
          name: "Denmark",
          continent: "Europe",
          difficulty: "easy",
          description: "Red background with a white Nordic cross shifted to the hoist side",
        },
        {
          code: "dm",
          name: "Dominica",
          continent: "North America",
          difficulty: "hard",
          description: "Green background with crosses forming quarters, and a red circle with a parrot in the center",
        },
        {
          code: "do",
          name: "Dominican Republic",
          continent: "North America",
          difficulty: "medium",
          description: "Quartered red and blue with a white cross and a coat of arms in the center",
        },
        {
          code: "dz",
          name: "Algeria",
          continent: "Africa",
          difficulty: "medium",
          description: "Vertical halves of green and white with a red crescent and star in the center",
        },
        {
          code: "ec",
          name: "Ecuador",
          continent: "South America",
          difficulty: "medium",
          description: "Three horizontal stripes of yellow (half), blue, and red with a coat of arms in the center",
        },
        {
          code: "ee",
          name: "Estonia",
          continent: "Europe",
          difficulty: "medium",
          description: "Three horizontal stripes of blue, black, and white",
        },
        {
          code: "eg",
          name: "Egypt",
          continent: "Africa",
          difficulty: "easy",
          description: "Three horizontal stripes of red, white, and black with a golden eagle in the center",
        },
        {
          code: "er",
          name: "Eritrea",
          continent: "Africa",
          difficulty: "hard",
          description:
            "Red triangle on the hoist with green and blue triangular sections and a yellow wreath and olive branch",
        },
        {
          code: "es",
          name: "Spain",
          continent: "Europe",
          difficulty: "easy",
          description: "Three horizontal stripes of red, yellow (wider), and red with a coat of arms",
        },
        {
          code: "et",
          name: "Ethiopia",
          continent: "Africa",
          difficulty: "medium",
          description: "Three horizontal stripes of green, yellow, and red with a blue circle and yellow star emblem",
        },
        {
          code: "fi",
          name: "Finland",
          continent: "Europe",
          difficulty: "easy",
          description: "White background with a blue Nordic cross shifted to the hoist side",
        },
        {
          code: "fj",
          name: "Fiji",
          continent: "Oceania",
          difficulty: "hard",
          description: "Light blue background with Union Jack in corner and a shield with a red cross",
        },
        {
          code: "fm",
          name: "Micronesia",
          continent: "Oceania",
          difficulty: "hard",
          description: "Light blue background with four white stars arranged in a diamond pattern",
        },
        {
          code: "fr",
          name: "France",
          continent: "Europe",
          difficulty: "easy",
          description: "Vertical tricolor of blue, white, and red",
        },
        {
          code: "ga",
          name: "Gabon",
          continent: "Africa",
          difficulty: "hard",
          description: "Three horizontal stripes of green, yellow, and blue",
        },
        {
          code: "gb",
          name: "United Kingdom",
          continent: "Europe",
          difficulty: "easy",
          description: "Blue background with red and white crosses forming the Union Jack",
        },
        {
          code: "gd",
          name: "Grenada",
          continent: "North America",
          difficulty: "hard",
          description: "Red border with yellow stars, green and yellow triangles inside, and a nutmeg symbol",
        },
        {
          code: "ge",
          name: "Georgia",
          continent: "Asia",
          difficulty: "medium",
          description: "White background with a large red cross and four small red crosses in each quadrant",
        },
        {
          code: "gh",
          name: "Ghana",
          continent: "Africa",
          difficulty: "medium",
          description: "Three horizontal stripes of red, yellow, and green with a black star in the center",
        },
        {
          code: "gm",
          name: "Gambia",
          continent: "Africa",
          difficulty: "hard",
          description: "Horizontal stripes of red, blue, and green separated by thin white stripes",
        },
        {
          code: "gn",
          name: "Guinea",
          continent: "Africa",
          difficulty: "medium",
          description: "Vertical tricolor of red, yellow, and green",
        },
        {
          code: "gq",
          name: "Equatorial Guinea",
          continent: "Africa",
          difficulty: "hard",
          description: "Horizontal green, white, and red stripes with a blue triangle on the hoist and a coat of arms",
        },
        {
          code: "gr",
          name: "Greece",
          continent: "Europe",
          difficulty: "easy",
          description: "Blue and white horizontal stripes with a blue square containing a white cross in the corner",
        },
        {
          code: "gt",
          name: "Guatemala",
          continent: "North America",
          difficulty: "medium",
          description: "Three vertical stripes of light blue, white, and light blue with a coat of arms in the center",
        },
        {
          code: "gw",
          name: "Guinea-Bissau",
          continent: "Africa",
          difficulty: "hard",
          description: "Vertical red stripe on the hoist with horizontal yellow and green stripes and a black star",
        },
        {
          code: "gy",
          name: "Guyana",
          continent: "South America",
          difficulty: "hard",
          description:
            "Green background with yellow triangle bordered by white, containing a red triangle bordered by black",
        },
        {
          code: "hn",
          name: "Honduras",
          continent: "North America",
          difficulty: "medium",
          description: "Three horizontal stripes of blue, white, and blue with five blue stars in the center",
        },
        {
          code: "hr",
          name: "Croatia",
          continent: "Europe",
          difficulty: "medium",
          description: "Three horizontal stripes of red, white, and blue with a checkered coat of arms in the center",
        },
        {
          code: "ht",
          name: "Haiti",
          continent: "North America",
          difficulty: "medium",
          description: "Horizontal blue and red stripes with a coat of arms featuring a palm tree in the center",
        },
        {
          code: "hu",
          name: "Hungary",
          continent: "Europe",
          difficulty: "medium",
          description: "Three horizontal stripes of red, white, and green",
        },
        {
          code: "id",
          name: "Indonesia",
          continent: "Asia",
          difficulty: "hard",
          description: "Two horizontal stripes of red and white",
        },
        {
          code: "ie",
          name: "Ireland",
          continent: "Europe",
          difficulty: "easy",
          description: "Vertical tricolor of green, white, and orange",
        },
        {
          code: "il",
          name: "Israel",
          continent: "Asia",
          difficulty: "easy",
          description: "White background with two horizontal blue stripes and a blue Star of David in the center",
        },
        {
          code: "in",
          name: "India",
          continent: "Asia",
          difficulty: "easy",
          description: "Three horizontal stripes of saffron, white, and green with a blue wheel in the center",
        },
        {
          code: "iq",
          name: "Iraq",
          continent: "Asia",
          difficulty: "medium",
          description: "Three horizontal stripes of red, white, and black with green Arabic text in the center",
        },
        {
          code: "ir",
          name: "Iran",
          continent: "Asia",
          difficulty: "medium",
          description: "Three horizontal stripes of green, white, and red with a red emblem in the center",
        },
        {
          code: "is",
          name: "Iceland",
          continent: "Europe",
          difficulty: "easy",
          description: "Blue background with a red Nordic cross outlined in white shifted to the hoist side",
        },
        {
          code: "it",
          name: "Italy",
          continent: "Europe",
          difficulty: "easy",
          description: "Vertical tricolor of green, white, and red",
        },
        {
          code: "jm",
          name: "Jamaica",
          continent: "North America",
          difficulty: "medium",
          description:
            "Gold diagonal cross dividing the flag into green triangles at top and bottom and black at sides",
        },
        {
          code: "jo",
          name: "Jordan",
          continent: "Asia",
          difficulty: "hard",
          description:
            "Horizontal black, white, and green stripes with a red triangle on the hoist featuring a white star",
        },
        {
          code: "jp",
          name: "Japan",
          continent: "Asia",
          difficulty: "easy",
          description: "White background with a large red circle in the center",
        },
        {
          code: "ke",
          name: "Kenya",
          continent: "Africa",
          difficulty: "medium",
          description:
            "Horizontal black, red, and green stripes with white borders and a Maasai shield with spears in center",
        },
        {
          code: "kg",
          name: "Kyrgyzstan",
          continent: "Asia",
          difficulty: "hard",
          description: "Red background with a yellow sun containing a red circular pattern in the center",
        },
        {
          code: "kh",
          name: "Cambodia",
          continent: "Asia",
          difficulty: "medium",
          description: "Red with blue stripes on top and bottom edges and a white temple (Angkor Wat) in the center",
        },
        {
          code: "ki",
          name: "Kiribati",
          continent: "Oceania",
          difficulty: "hard",
          description: "Red background with wavy white and blue stripes at bottom and a yellow sun with a bird over it",
        },
        {
          code: "km",
          name: "Comoros",
          continent: "Africa",
          difficulty: "hard",
          description:
            "Four horizontal stripes of yellow, white, red, and blue with a green triangle and white crescent and stars",
        },
        {
          code: "kn",
          name: "Saint Kitts and Nevis",
          continent: "North America",
          difficulty: "hard",
          description: "Diagonal black band with two white stars bordered by yellow, with green and red triangles",
        },
        {
          code: "kp",
          name: "North Korea",
          continent: "Asia",
          difficulty: "medium",
          description:
            "Blue stripes on top and bottom, wide red stripe in center with a white circle containing a red star",
        },
        {
          code: "kr",
          name: "South Korea",
          continent: "Asia",
          difficulty: "easy",
          description: "White background with a red and blue yin-yang symbol and four black trigrams in the corners",
        },
        {
          code: "kw",
          name: "Kuwait",
          continent: "Asia",
          difficulty: "hard",
          description: "Horizontal green, white, and red stripes with a black trapezoid on the hoist",
        },
        {
          code: "kz",
          name: "Kazakhstan",
          continent: "Asia",
          difficulty: "medium",
          description:
            "Light blue background with a yellow sun and eagle in the center and ornamental pattern on hoist",
        },
        {
          code: "la",
          name: "Laos",
          continent: "Asia",
          difficulty: "hard",
          description: "Three horizontal stripes of red, blue (wider), and red with a white circle in the center",
        },
        {
          code: "lb",
          name: "Lebanon",
          continent: "Asia",
          difficulty: "hard",
          description: "Three horizontal stripes of red, white (wider), and red with a green cedar tree in the center",
        },
        {
          code: "lc",
          name: "Saint Lucia",
          continent: "North America",
          difficulty: "hard",
          description: "Light blue background with a gold and black triangular design in the center",
        },
        {
          code: "li",
          name: "Liechtenstein",
          continent: "Europe",
          difficulty: "hard",
          description: "Horizontal blue and red stripes with a gold crown in the top left corner",
        },
        {
          code: "lk",
          name: "Sri Lanka",
          continent: "Asia",
          difficulty: "medium",
          description:
            "Green and orange vertical stripes on left, maroon field with yellow lion holding a sword and leaves",
        },
        {
          code: "lr",
          name: "Liberia",
          continent: "Africa",
          difficulty: "hard",
          description: "Red and white horizontal stripes with a blue square containing a white star in the corner",
        },
        {
          code: "ls",
          name: "Lesotho",
          continent: "Africa",
          difficulty: "hard",
          description: "Horizontal blue, white, and green stripes with a black traditional hat in the center",
        },
        {
          code: "lt",
          name: "Lithuania",
          continent: "Europe",
          difficulty: "medium",
          description: "Three horizontal stripes of yellow, green, and red",
        },
        {
          code: "lu",
          name: "Luxembourg",
          continent: "Europe",
          difficulty: "hard",
          description: "Three horizontal stripes of red, white, and light blue",
        },
        {
          code: "lv",
          name: "Latvia",
          continent: "Europe",
          difficulty: "medium",
          description: "Three horizontal stripes of dark red, white (narrower), and dark red",
        },
        {
          code: "ly",
          name: "Libya",
          continent: "Africa",
          difficulty: "hard",
          description: "Horizontal red, black, and green stripes with a white crescent and star in the center",
        },
        {
          code: "ma",
          name: "Morocco",
          continent: "Africa",
          difficulty: "medium",
          description: "Red background with a green star in the center",
        },
        {
          code: "mc",
          name: "Monaco",
          continent: "Europe",
          difficulty: "hard",
          description: "Two horizontal stripes of red and white",
        },
        {
          code: "md",
          name: "Moldova",
          continent: "Europe",
          difficulty: "hard",
          description: "Vertical tricolor of blue, yellow, and red with a coat of arms in the center",
        },
        {
          code: "me",
          name: "Montenegro",
          continent: "Europe",
          difficulty: "medium",
          description: "Red background with a golden double-headed eagle and a coat of arms in the center",
        },
        {
          code: "mg",
          name: "Madagascar",
          continent: "Africa",
          difficulty: "medium",
          description: "White vertical stripe on left with horizontal red and green stripes on right",
        },
        {
          code: "mh",
          name: "Marshall Islands",
          continent: "Oceania",
          difficulty: "hard",
          description: "Blue background with diagonal orange and white stripes and a white star in the corner",
        },
        {
          code: "mk",
          name: "North Macedonia",
          continent: "Europe",
          difficulty: "medium",
          description: "Red background with a yellow sun with eight rays extending to the edges",
        },
        {
          code: "ml",
          name: "Mali",
          continent: "Africa",
          difficulty: "medium",
          description: "Vertical tricolor of green, yellow, and red",
        },
        {
          code: "mm",
          name: "Myanmar",
          continent: "Asia",
          difficulty: "medium",
          description: "Horizontal yellow, green, and red stripes with a large white star in the center",
        },
        {
          code: "mn",
          name: "Mongolia",
          continent: "Asia",
          difficulty: "medium",
          description: "Vertical red, blue, and red stripes with a yellow symbol on the hoist stripe",
        },
        {
          code: "mr",
          name: "Mauritania",
          continent: "Africa",
          difficulty: "hard",
          description: "Green background with a yellow crescent and star, bordered by red stripes on top and bottom",
        },
        {
          code: "mt",
          name: "Malta",
          continent: "Europe",
          difficulty: "hard",
          description: "Vertical halves of white and red with a George Cross in the corner",
        },
        {
          code: "mu",
          name: "Mauritius",
          continent: "Africa",
          difficulty: "hard",
          description: "Four horizontal stripes of red, blue, yellow, and green",
        },
        {
          code: "mv",
          name: "Maldives",
          continent: "Asia",
          difficulty: "hard",
          description: "Red background with a green rectangle containing a white crescent in the center",
        },
        {
          code: "mw",
          name: "Malawi",
          continent: "Africa",
          difficulty: "hard",
          description: "Horizontal black, red, and green stripes with a red rising sun on the top stripe",
        },
        {
          code: "mx",
          name: "Mexico",
          continent: "North America",
          difficulty: "easy",
          description: "Vertical tricolor of green, white, and red with an eagle on a cactus in the center",
        },
        {
          code: "my",
          name: "Malaysia",
          continent: "Asia",
          difficulty: "medium",
          description: "Red and white horizontal stripes with a blue canton containing a yellow crescent and star",
        },
        {
          code: "mz",
          name: "Mozambique",
          continent: "Africa",
          difficulty: "hard",
          description:
            "Horizontal green, black, and yellow stripes with white borders and a red triangle with a star and rifle",
        },
        {
          code: "na",
          name: "Namibia",
          continent: "Africa",
          difficulty: "medium",
          description:
            "Diagonal red stripe bordered by white from bottom left to top right, blue and green triangles, with yellow sun",
        },
        {
          code: "ne",
          name: "Niger",
          continent: "Africa",
          difficulty: "hard",
          description: "Three horizontal stripes of orange, white, and green with an orange circle in the center",
        },
        {
          code: "ng",
          name: "Nigeria",
          continent: "Africa",
          difficulty: "medium",
          description: "Vertical tricolor of green, white, and green",
        },
        {
          code: "ni",
          name: "Nicaragua",
          continent: "North America",
          difficulty: "hard",
          description: "Three horizontal stripes of blue, white, and blue with a coat of arms in the center",
        },
        {
          code: "nl",
          name: "Netherlands",
          continent: "Europe",
          difficulty: "easy",
          description: "Three horizontal stripes of red, white, and blue",
        },
        {
          code: "no",
          name: "Norway",
          continent: "Europe",
          difficulty: "easy",
          description: "Red background with a blue Nordic cross outlined in white shifted to the hoist side",
        },
        {
          code: "np",
          name: "Nepal",
          continent: "Asia",
          difficulty: "medium",
          description: "Two stacked triangular pennants in red with blue border, containing white moon and sun symbols",
        },
        {
          code: "nr",
          name: "Nauru",
          continent: "Oceania",
          difficulty: "hard",
          description: "Blue background with a yellow horizontal stripe and white star below the stripe on the left",
        },
        {
          code: "nz",
          name: "New Zealand",
          continent: "Oceania",
          difficulty: "easy",
          description:
            "Blue background with Union Jack in corner and four red stars with white borders forming the Southern Cross",
        },
        {
          code: "om",
          name: "Oman",
          continent: "Asia",
          difficulty: "hard",
          description:
            "Horizontal white, red, and green stripes with a red vertical band featuring a white emblem on the hoist",
        },
        {
          code: "pa",
          name: "Panama",
          continent: "North America",
          difficulty: "medium",
          description: "Four quarters with white squares containing blue and red stars, and solid blue and red squares",
        },
        {
          code: "pe",
          name: "Peru",
          continent: "South America",
          difficulty: "medium",
          description: "Vertical tricolor of red, white, and red with a coat of arms in the center",
        },
        {
          code: "pg",
          name: "Papua New Guinea",
          continent: "Oceania",
          difficulty: "medium",
          description: "Diagonal division from top left to bottom right with red and black, bird of paradise and stars",
        },
        {
          code: "ph",
          name: "Philippines",
          continent: "Asia",
          difficulty: "medium",
          description: "Horizontal blue and red stripes with white triangle on hoist containing a sun and three stars",
        },
        {
          code: "pk",
          name: "Pakistan",
          continent: "Asia",
          difficulty: "medium",
          description: "Green background with a white vertical band on the hoist, white crescent and star on green",
        },
        {
          code: "pl",
          name: "Poland",
          continent: "Europe",
          difficulty: "medium",
          description: "Two horizontal stripes of white and red",
        },
        {
          code: "pt",
          name: "Portugal",
          continent: "Europe",
          difficulty: "easy",
          description:
            "Vertical green and red stripes with the armillary sphere and shield coat of arms at the junction",
        },
        {
          code: "pw",
          name: "Palau",
          continent: "Oceania",
          difficulty: "hard",
          description: "Light blue background with a large yellow circle slightly off-center to the hoist",
        },
        {
          code: "py",
          name: "Paraguay",
          continent: "South America",
          difficulty: "hard",
          description: "Three horizontal stripes of red, white, and blue with a coat of arms in the center",
        },
        {
          code: "qa",
          name: "Qatar",
          continent: "Asia",
          difficulty: "medium",
          description: "Maroon background with a white serrated band on the hoist side with nine points",
        },
        {
          code: "ro",
          name: "Romania",
          continent: "Europe",
          difficulty: "medium",
          description: "Vertical tricolor of blue, yellow, and red",
        },
        {
          code: "rs",
          name: "Serbia",
          continent: "Europe",
          difficulty: "medium",
          description: "Three horizontal stripes of red, blue, and white with a coat of arms on the left side",
        },
        {
          code: "ru",
          name: "Russia",
          continent: "Europe",
          difficulty: "easy",
          description: "Three horizontal stripes of white, blue, and red",
        },
        {
          code: "rw",
          name: "Rwanda",
          continent: "Africa",
          difficulty: "hard",
          description: "Horizontal blue, yellow, and green stripes with a yellow sun in the upper right corner",
        },
        {
          code: "sa",
          name: "Saudi Arabia",
          continent: "Asia",
          difficulty: "easy",
          description: "Green background with white Arabic text and a sword below it",
        },
        {
          code: "sb",
          name: "Solomon Islands",
          continent: "Oceania",
          difficulty: "hard",
          description:
            "Diagonal yellow stripe from bottom left to top right dividing blue and green with five white stars",
        },
        {
          code: "sc",
          name: "Seychelles",
          continent: "Africa",
          difficulty: "hard",
          description: "Five radiating bands of blue, yellow, red, white, and green from the bottom left corner",
        },
        {
          code: "sd",
          name: "Sudan",
          continent: "Africa",
          difficulty: "hard",
          description: "Horizontal red, white, and black stripes with a green triangle on the hoist",
        },
        {
          code: "se",
          name: "Sweden",
          continent: "Europe",
          difficulty: "easy",
          description: "Blue background with a yellow Nordic cross shifted to the hoist side",
        },
        {
          code: "sg",
          name: "Singapore",
          continent: "Asia",
          difficulty: "medium",
          description: "Horizontal red and white stripes with a white crescent and five stars in the corner",
        },
        {
          code: "si",
          name: "Slovenia",
          continent: "Europe",
          difficulty: "medium",
          description: "Three horizontal stripes of white, blue, and red with a coat of arms in the corner",
        },
        {
          code: "sk",
          name: "Slovakia",
          continent: "Europe",
          difficulty: "medium",
          description: "Three horizontal stripes of white, blue, and red with a coat of arms on the left",
        },
        {
          code: "sl",
          name: "Sierra Leone",
          continent: "Africa",
          difficulty: "hard",
          description: "Three horizontal stripes of green, white, and blue",
        },
        {
          code: "sm",
          name: "San Marino",
          continent: "Europe",
          difficulty: "hard",
          description: "Horizontal white and light blue stripes with a coat of arms in the center",
        },
        {
          code: "sn",
          name: "Senegal",
          continent: "Africa",
          difficulty: "medium",
          description: "Vertical tricolor of green, yellow, and red with a green star in the center",
        },
        {
          code: "so",
          name: "Somalia",
          continent: "Africa",
          difficulty: "medium",
          description: "Light blue background with a white star in the center",
        },
        {
          code: "sr",
          name: "Suriname",
          continent: "South America",
          difficulty: "hard",
          description: "Horizontal green, white, red, white, and green stripes with a yellow star in the center",
        },
        {
          code: "ss",
          name: "South Sudan",
          continent: "Africa",
          difficulty: "hard",
          description:
            "Horizontal black, red, and green stripes with white borders and a blue triangle with yellow star on hoist",
        },
        {
          code: "st",
          name: "Sao Tome and Principe",
          continent: "Africa",
          difficulty: "hard",
          description: "Horizontal green, yellow, and green stripes with a red triangle on hoist and two black stars",
        },
        {
          code: "sv",
          name: "El Salvador",
          continent: "North America",
          difficulty: "medium",
          description: "Three horizontal stripes of blue, white, and blue with a coat of arms in the center",
        },
        {
          code: "sy",
          name: "Syria",
          continent: "Asia",
          difficulty: "hard",
          description: "Horizontal red, white, and black stripes with two green stars in the center white stripe",
        },
        {
          code: "sz",
          name: "Eswatini",
          continent: "Africa",
          difficulty: "hard",
          description:
            "Horizontal blue, yellow, red, yellow, and blue stripes with a black and white shield and weapons",
        },
        {
          code: "td",
          name: "Chad",
          continent: "Africa",
          difficulty: "hard",
          description: "Vertical tricolor of blue, yellow, and red",
        },
        {
          code: "tg",
          name: "Togo",
          continent: "Africa",
          difficulty: "hard",
          description:
            "Five horizontal stripes alternating green and yellow with a red square containing a white star in corner",
        },
        {
          code: "th",
          name: "Thailand",
          continent: "Asia",
          difficulty: "easy",
          description: "Five horizontal stripes of red, white, blue (wider), white, and red",
        },
        {
          code: "tj",
          name: "Tajikistan",
          continent: "Asia",
          difficulty: "hard",
          description: "Horizontal red, white, and green stripes with a crown and stars in the center",
        },
        {
          code: "tl",
          name: "Timor-Leste",
          continent: "Asia",
          difficulty: "hard",
          description: "Red background with yellow triangle on hoist containing a black triangle with a white star",
        },
        {
          code: "tm",
          name: "Turkmenistan",
          continent: "Asia",
          difficulty: "hard",
          description:
            "Green background with a red vertical stripe featuring carpet patterns and a crescent with stars",
        },
        {
          code: "tn",
          name: "Tunisia",
          continent: "Africa",
          difficulty: "medium",
          description: "Red background with a white circle containing a red crescent and star",
        },
        {
          code: "to",
          name: "Tonga",
          continent: "Oceania",
          difficulty: "hard",
          description: "Red background with a white rectangle in the corner containing a red cross",
        },
        {
          code: "tr",
          name: "Turkey",
          continent: "Asia",
          difficulty: "easy",
          description: "Red background with a white crescent and star",
        },
        {
          code: "tt",
          name: "Trinidad and Tobago",
          continent: "North America",
          difficulty: "medium",
          description: "Red background with a black diagonal stripe bordered by white from top left to bottom right",
        },
        {
          code: "tv",
          name: "Tuvalu",
          continent: "Oceania",
          difficulty: "hard",
          description: "Light blue background with Union Jack in corner and nine yellow stars representing islands",
        },
        {
          code: "tw",
          name: "Taiwan",
          continent: "Asia",
          difficulty: "medium",
          description: "Red background with a blue canton containing a white sun with twelve rays",
        },
        {
          code: "tz",
          name: "Tanzania",
          continent: "Africa",
          difficulty: "medium",
          description:
            "Diagonal yellow stripe bordered by black from bottom left to top right, green and blue triangles",
        },
        {
          code: "ua",
          name: "Ukraine",
          continent: "Europe",
          difficulty: "easy",
          description: "Two horizontal stripes of blue and yellow",
        },
        {
          code: "ug",
          name: "Uganda",
          continent: "Africa",
          difficulty: "medium",
          description:
            "Six horizontal stripes of black, yellow, and red repeated with a white circle containing a crested crane",
        },
        {
          code: "us",
          name: "United States",
          continent: "North America",
          difficulty: "easy",
          description: "Red and white horizontal stripes with a blue canton containing white stars",
        },
        {
          code: "uy",
          name: "Uruguay",
          continent: "South America",
          difficulty: "medium",
          description: "White and blue horizontal stripes with a white square in corner containing a yellow sun",
        },
        {
          code: "uz",
          name: "Uzbekistan",
          continent: "Asia",
          difficulty: "hard",
          description: "Horizontal blue, white, and green stripes with red borders, crescent and stars in top left",
        },
        {
          code: "va",
          name: "Vatican City",
          continent: "Europe",
          difficulty: "medium",
          description: "Vertical halves of yellow and white with the papal tiara and crossed keys",
        },
        {
          code: "vc",
          name: "Saint Vincent and the Grenadines",
          continent: "North America",
          difficulty: "hard",
          description:
            "Vertical stripes of blue, yellow, and green with three green diamonds arranged in a V in the center",
        },
        {
          code: "ve",
          name: "Venezuela",
          continent: "South America",
          difficulty: "medium",
          description:
            "Three horizontal stripes of yellow, blue, and red with an arc of eight white stars in the center",
        },
        {
          code: "vn",
          name: "Vietnam",
          continent: "Asia",
          difficulty: "medium",
          description: "Red background with a large yellow star in the center",
        },
        {
          code: "vu",
          name: "Vanuatu",
          continent: "Oceania",
          difficulty: "hard",
          description:
            "Horizontal red and green sections divided by a yellow Y-shape with black borders and a boar tusk emblem",
        },
        {
          code: "ws",
          name: "Samoa",
          continent: "Oceania",
          difficulty: "hard",
          description: "Red background with a blue canton containing five white stars of the Southern Cross",
        },
        {
          code: "ye",
          name: "Yemen",
          continent: "Asia",
          difficulty: "hard",
          description: "Three horizontal stripes of red, white, and black",
        },
        {
          code: "za",
          name: "South Africa",
          continent: "Africa",
          difficulty: "easy",
          description:
            "Horizontal Y-shape in green with black borders separating red, blue, white, and yellow sections",
        },
        {
          code: "zm",
          name: "Zambia",
          continent: "Africa",
          difficulty: "medium",
          description:
            "Green background with an orange eagle over three vertical stripes of red, black, and orange in the corner",
        },
        {
          code: "zw",
          name: "Zimbabwe",
          continent: "Africa",
          difficulty: "medium",
          description:
            "Horizontal green, yellow, red, black, red, yellow, and green stripes with white triangle containing Zimbabwe bird on red star",
        },
      ];

      const CAPITALS = {
        ad: "Andorra la Vella",
        ae: "Abu Dhabi",
        af: "Kabul",
        ag: "Saint John's",
        al: "Tirana",
        am: "Yerevan",
        ao: "Luanda",
        ar: "Buenos Aires",
        at: "Vienna",
        au: "Canberra",
        az: "Baku",
        ba: "Sarajevo",
        bb: "Bridgetown",
        bd: "Dhaka",
        be: "Brussels",
        bf: "Ouagadougou",
        bg: "Sofia",
        bh: "Manama",
        bi: "Gitega",
        bj: "Porto-Novo",
        bn: "Bandar Seri Begawan",
        bo: "Sucre",
        br: "Bras√≠lia",
        bs: "Nassau",
        bt: "Thimphu",
        bw: "Gaborone",
        by: "Minsk",
        bz: "Belmopan",
        ca: "Ottawa",
        cd: "Kinshasa",
        cf: "Bangui",
        cg: "Brazzaville",
        ch: "Bern",
        ci: "Yamoussoukro",
        cl: "Santiago",
        cm: "Yaound√©",
        cn: "Beijing",
        co: "Bogot√°",
        cr: "San Jos√©",
        cu: "Havana",
        cv: "Praia",
        cy: "Nicosia",
        cz: "Prague",
        de: "Berlin",
        dj: "Djibouti",
        dk: "Copenhagen",
        dm: "Roseau",
        do: "Santo Domingo",
        dz: "Algiers",
        ec: "Quito",
        ee: "Tallinn",
        eg: "Cairo",
        er: "Asmara",
        es: "Madrid",
        et: "Addis Ababa",
        fi: "Helsinki",
        fj: "Suva",
        fm: "Palikir",
        fr: "Paris",
        ga: "Libreville",
        gb: "London",
        gd: "St. George's",
        ge: "Tbilisi",
        gh: "Accra",
        gm: "Banjul",
        gn: "Conakry",
        gq: "Malabo",
        gr: "Athens",
        gt: "Guatemala City",
        gw: "Bissau",
        gy: "Georgetown",
        hn: "Tegucigalpa",
        hr: "Zagreb",
        ht: "Port-au-Prince",
        hu: "Budapest",
        id: "Jakarta",
        ie: "Dublin",
        il: "Jerusalem",
        in: "New Delhi",
        iq: "Baghdad",
        ir: "Tehran",
        is: "Reykjavik",
        it: "Rome",
        jm: "Kingston",
        jo: "Amman",
        jp: "Tokyo",
        ke: "Nairobi",
        kg: "Bishkek",
        kh: "Phnom Penh",
        ki: "South Tarawa",
        km: "Moroni",
        kn: "Basseterre",
        kp: "Pyongyang",
        kr: "Seoul",
        kw: "Kuwait City",
        kz: "Astana",
        la: "Vientiane",
        lb: "Beirut",
        lc: "Castries",
        li: "Vaduz",
        lk: "Sri Jayawardenepura Kotte",
        lr: "Monrovia",
        ls: "Maseru",
        lt: "Vilnius",
        lu: "Luxembourg",
        lv: "Riga",
        ly: "Tripoli",
        ma: "Rabat",
        mc: "Monaco",
        md: "Chisinau",
        me: "Podgorica",
        mg: "Antananarivo",
        mh: "Majuro",
        mk: "Skopje",
        ml: "Bamako",
        mm: "Naypyidaw",
        mn: "Ulaanbaatar",
        mr: "Nouakchott",
        mt: "Valletta",
        mu: "Port Louis",
        mv: "Mal√©",
        mw: "Lilongwe",
        mx: "Mexico City",
        my: "Kuala Lumpur",
        mz: "Maputo",
        na: "Windhoek",
        ne: "Niamey",
        ng: "Abuja",
        ni: "Managua",
        nl: "Amsterdam",
        no: "Oslo",
        np: "Kathmandu",
        nr: "Yaren",
        nz: "Wellington",
        om: "Muscat",
        pa: "Panama City",
        pe: "Lima",
        pg: "Port Moresby",
        ph: "Manila",
        pk: "Islamabad",
        pl: "Warsaw",
        pt: "Lisbon",
        pw: "Ngerulmud",
        py: "Asunci√≥n",
        qa: "Doha",
        ro: "Bucharest",
        rs: "Belgrade",
        ru: "Moscow",
        rw: "Kigali",
        sa: "Riyadh",
        sb: "Honiara",
        sc: "Victoria",
        sd: "Khartoum",
        se: "Stockholm",
        sg: "Singapore",
        si: "Ljubljana",
        sk: "Bratislava",
        sl: "Freetown",
        sm: "San Marino",
        sn: "Dakar",
        so: "Mogadishu",
        sr: "Paramaribo",
        ss: "Juba",
        st: "S√£o Tom√©",
        sv: "San Salvador",
        sy: "Damascus",
        sz: "Mbabane",
        td: "N'Djamena",
        tg: "Lom√©",
        th: "Bangkok",
        tj: "Dushanbe",
        tl: "Dili",
        tm: "Ashgabat",
        tn: "Tunis",
        to: "Nuku'alofa",
        tr: "Ankara",
        tt: "Port of Spain",
        tv: "Funafuti",
        tw: "Taipei",
        tz: "Dodoma",
        ua: "Kyiv",
        ug: "Kampala",
        us: "Washington, D.C.",
        uy: "Montevideo",
        uz: "Tashkent",
        va: "Vatican City",
        vc: "Kingstown",
        ve: "Caracas",
        vn: "Hanoi",
        vu: "Port Vila",
        ws: "Apia",
        ye: "Sanaa",
        za: "Pretoria",
        zm: "Lusaka",
        zw: "Harare",
      };

      // Merge capitals
      COUNTRIES.forEach((c) => {
        if (CAPITALS[c.code]) {
          c.capital = CAPITALS[c.code];
        } else {
          console.warn("Missing capital for", c.code);
          c.capital = "Unknown";
        }
      });

      const SIMILAR_FLAGS = {
        ro: ["td", "ad", "md"], // Romania -> Chad, Andorra, Moldova
        td: ["ro", "ad", "md"], // Chad -> Romania...
        id: ["mc", "pl", "sg"], // Indonesia -> Monaco, Poland, Singapore
        mc: ["id", "pl", "sg"],
        pl: ["id", "mc", "sg"],
        ie: ["ci", "it"], // Ireland -> Ivory Coast, Italy
        ci: ["ie", "it"],
        nz: ["au", "gb"], // NZ -> Australia, UK
        au: ["nz", "gb"],
        ml: ["gn", "gh"], // Mali -> Guinea, Ghana
        gn: ["ml", "gh", "gw"],
        ve: ["ec", "co"], // Venezuela -> Ecuador, Colombia
        ec: ["ve", "co"],
        co: ["ve", "ec"],
        lu: ["nl", "py", "fr"], // Luxembourg -> Netherlands, Paraguay, France
        nl: ["lu", "py", "fr"],
        hr: ["rs", "si", "sk", "ru"], // Croatia -> Serbia, Slovenia, Slovakia, Russia
        rs: ["hr", "si", "sk", "ru"],
        si: ["hr", "rs", "sk", "ru"],
        sk: ["hr", "rs", "si", "ru"],
        ru: ["si", "sk", "rs"],
        no: ["is", "dk", "fi", "se"], // Nordic Crosses
        is: ["no", "dk", "fi", "se"],
        dk: ["no", "is", "fi", "se"],
        fi: ["no", "is", "dk", "se"],
        se: ["no", "is", "dk", "fi"],
        us: ["lr", "my"], // USA -> Liberia, Malaysia
        lr: ["us", "my", "cl"],
        my: ["us", "lr"],
        cu: ["pr", "ph"], // Cuba -> Puerto Rico (not in list but similar style), Philippines
        cl: ["tx", "lr"], // Chile -> Texas (lol), Liberia
        jp: ["bd", "pw"], // Japan -> Bangladesh, Palau
        bd: ["jp", "pw"],
        tr: ["tn", "pk"], // Turkey -> Tunisia, Pakistan
        tn: ["tr", "pk", "dz"],
        cn: ["vn", "su"], // China -> Vietnam, USSR(hist)
        vn: ["cn", "ma"],
        so: ["vn", "mm"], // Somalia (star)
        qa: ["bh"], // Qatar -> Bahrain
        bh: ["qa"],
        sv: ["ni", "hn", "gt", "ar"], // Central American blue/white
        ni: ["sv", "hn", "gt", "ar"],
        hn: ["sv", "ni", "gt", "ar"],
        gt: ["sv", "ni", "hn", "ar"],
        ar: ["sv", "ni", "hn", "gt", "uy"],
      };

      const ICONS = {
        heart: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>`,
        heartFilled: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-500"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>`,
        trophy: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-400"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>`,
        trophyLarge: `<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-400"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>`,
        heartLarge: `<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>`,
        x: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>`,
        check: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>`,
        rotateCcw: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/></svg>`,
        share: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>`,
        lightning: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-400"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>`,
        book: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>`,
        globe: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>`,
        gear: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>`,
        volume: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>`,
        volumeOff: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></svg>`,
        play: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>`,
        pause: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>`,
      };

      createApp({
        setup() {
          // State
          const screen = ref("start"); // start, playing, end
          const gameMode = ref("normal"); // normal, reverse, blitz
          const score = ref(0);
          const lives = ref(3);
          const streak = ref(0);
          const wrongAnswers = ref([]);
          const showMistakesModal = ref(false);
          const highScore = ref(0);
          const queue = ref([]);
          const currentIndex = ref(0);
          const currentQuestion = ref(null);
          const selectedOption = ref(null);
          const currentEffect = ref(null);
          const feedback = ref(null); // 'correct', 'incorrect', 'timeout', null
          const lastFeedback = ref(null); // To persist feedback during transition
          const hasCelebratedHighScore = ref(false);
          const userAnswer = ref(""); // For hard mode

          // Passport / Collection State
          const collectedFlags = ref({}); // { 'us': 1, 'fr': 3 } - counts of correct answers

          // Region Filter
          const selectedRegion = ref("World");
          const showRegionSelector = ref(false);
          const continents = ["World", "Africa", "Asia", "Europe", "North America", "Oceania", "South America"];

          // Settings State
          const soundEnabled = ref(true);
          const autoContinue = ref(false);
          const showSettings = ref(false);

          // Timer State (Blitz Mode)
          const timerInterval = ref(null);
          const timeLeft = ref(0);
          const BLITZ_TIME = 5; // seconds
          const autoAdvanceTimer = ref(null);

          let audioContext = null;
          let fireworksInstance = null;
          const fireworksContainer = ref(null);

          // Visual Effects State
          const floatingPoints = ref([]);
          const shakeActive = ref(false);
          let pointIdCounter = 0;

          // Game Modes Config
          const gameModes = [
            {
              id: "normal",
              name: "Normal",
              description: "Identify the flag shown",
              color: "green",
              icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>`,
            },
            {
              id: "reverse",
              name: "Reverse",
              description: "Find the flag for the country",
              color: "purple",
              icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="21 8 21 21 3 21 3 8"/><line x1="1" y1="3" x2="23" y2="3"/><line x1="12" y1="14" x2="12" y2="21"/></svg>`,
            },
            {
              id: "blitz",
              name: "Blitz",
              description: "Fast-paced timed challenge",
              color: "red",
              icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-400"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>`,
            },
            {
              id: "hard",
              name: "Hard",
              description: "Type the country name",
              color: "blue",
              icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>`,
            },
            {
              id: "capitals",
              name: "Capitals",
              description: "Guess the capital city",
              color: "green",
              icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 21h18"/><path d="M5 21V7l8-4 8 4v14"/><path d="M8 21v-9a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v9"/></svg>`,
            },
            {
              id: "description",
              name: "Description",
              description: "Match description to flag",
              color: "blue",
              icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>`,
            },
            {
              id: "mindfuck",
              name: "Mindfuck",
              description: "Distorted, chaotic flags",
              color: "pink",
              icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.929 2.586a1 1 0 0 1 .485-.485c1.06-.53 2.536 1.414 2.586 2.929A10.003 10.003 0 0 1 12 22a10.003 10.003 0 0 1-10-10c.114-1.06 1.929-1.536 2.929-.586a1 1 0 0 1 .485.485c.53 1.06-1.414 2.536-2.929 2.586a10.003 10.003 0 0 0 14.142 0c-.05-1.515 1.414-3.465 2.929-2.929a1 1 0 0 1 .485.485z"/></svg>`,
            },
          ];

          // Logic
          const triggerFloatingPoints = (x, y, amount) => {
            const id = pointIdCounter++;
            // Adjust x/y to be relative to the app container if possible,
            // or just use client coordinates if the container is fixed/relative properly.
            // Since the floating points are in absolute container inside #app,
            // we need coordinates relative to #app.

            const appRect = document.getElementById("app").getBoundingClientRect();
            const relativeX = x - appRect.left;
            const relativeY = y - appRect.top;

            floatingPoints.value.push({ id, x: relativeX, y: relativeY, amount });

            setTimeout(() => {
              floatingPoints.value = floatingPoints.value.filter((p) => p.id !== id);
            }, 800);
          };

          const triggerShake = () => {
            shakeActive.value = true;
            setTimeout(() => {
              shakeActive.value = false;
            }, 500);
          };

          const loadScript = (src) => {
            return new Promise((resolve, reject) => {
              if (document.querySelector(`script[src="${src}"]`)) {
                resolve();
                return;
              }
              const script = document.createElement("script");
              script.src = src;
              script.onload = resolve;
              script.onerror = reject;
              document.head.appendChild(script);
            });
          };

          const levenshtein = (a, b) => {
            const matrix = [];
            for (let i = 0; i <= b.length; i++) matrix[i] = [i];
            for (let j = 0; j <= a.length; j++) matrix[0][j] = j;

            for (let i = 1; i <= b.length; i++) {
              for (let j = 1; j <= a.length; j++) {
                if (b.charAt(i - 1) === a.charAt(j - 1)) {
                  matrix[i][j] = matrix[i - 1][j - 1];
                } else {
                  matrix[i][j] = Math.min(
                    matrix[i - 1][j - 1] + 1,
                    Math.min(matrix[i][j - 1] + 1, matrix[i - 1][j] + 1)
                  );
                }
              }
            }
            return matrix[b.length][a.length];
          };

          const shuffleArray = (array) => {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
          };

          const generateQuestion = () => {
            // Reset effect for new question
            currentEffect.value = null;
            if (gameMode.value === "mindfuck") {
              const effects = ["mf-invert", "mf-grayscale", "mf-blur", "mf-flip-v", "mf-flip-h", "mf-spin", "mf-skew"];
              currentEffect.value = effects[Math.floor(Math.random() * effects.length)];
            }

            // Determine target difficulty based on streak
            // Streak 0-2: Easy (or mix)
            // Streak 3-5: Medium
            // Streak 6+: Hard
            let targetDifficulty = "medium";
            if (streak.value < 3) targetDifficulty = "easy";
            else if (streak.value > 5) targetDifficulty = "hard";

            // If struggling (low lives), bias towards easy
            if (lives.value === 1) targetDifficulty = "easy";

            // Filter available countries by difficulty if possible
            let availablePool = COUNTRIES.filter((c) => !queue.value.includes(c)); // Simplified: In a real endless mode we'd pick from non-recent

            // Note: The original game logic used a fixed 'queue' shuffled at start.
            // To support adaptive difficulty, we need to pick the *next* question dynamically,
            // rather than pre-determining the whole list.
            // However, 'queue' is currently used for progress tracking (currentIndex / queue.length).
            // For now, let's keep using the queue but we might need to resort it or just pick
            // from the remaining items in the queue that match our criteria.

            // Let's look at the *next* item in the pre-shuffled queue as the "base" choice,
            // but maybe we can swap it with something else in the queue if it doesn't match our difficulty target?
            // Or, for true adaptive difficulty, we should just pick a random unasked country that fits the criteria.

            // Since rewriting the whole queue logic is a bigger refactor, let's do this:
            // We will stick to the current correctOption (queue[currentIndex]), BUT we will
            // make the DISTRACTORS smart.
            // AND, if we want to truly change the *Question* difficulty, we would need to shuffle the queue
            // so that a 'Hard' country comes next.

            // Strategy: Look ahead in the queue. Find the first country that matches targetDifficulty.
            // Swap it with the current position.

            let correctOption = queue.value[currentIndex.value];

            // Try to find a better candidate in the future queue
            const futureIndex = queue.value
              .slice(currentIndex.value)
              .findIndex((c) => c.difficulty === targetDifficulty);
            if (futureIndex !== -1) {
              const actualIndex = currentIndex.value + futureIndex;
              // Swap
              const temp = queue.value[currentIndex.value];
              queue.value[currentIndex.value] = queue.value[actualIndex];
              queue.value[actualIndex] = temp;
              correctOption = queue.value[currentIndex.value];
            }

            // Pick 3 distractors
            const distractors = [];

            // 1. Similarity Traps (Priority)
            if (SIMILAR_FLAGS[correctOption.code]) {
              const traps = SIMILAR_FLAGS[correctOption.code];
              // Shuffle traps
              const shuffledTraps = shuffleArray(traps);

              for (const trapCode of shuffledTraps) {
                const trapCountry = COUNTRIES.find((c) => c.code === trapCode);
                if (trapCountry && distractors.length < 3) {
                  distractors.push(trapCountry);
                }
              }
            }

            // 2. Filter available distractors (Region based if possible)
            let availableDistractors = COUNTRIES.filter(
              (c) => c.code !== correctOption.code && !distractors.includes(c)
            );
            if (selectedRegion.value !== "World") {
              availableDistractors = availableDistractors.filter((c) => c.continent === selectedRegion.value);
            }

            // Fallback if not enough
            if (availableDistractors.length < 3) {
              availableDistractors = COUNTRIES.filter((c) => c.code !== correctOption.code && !distractors.includes(c));
            }

            // Fill remaining spots
            while (distractors.length < 3) {
              const randomIndex = Math.floor(Math.random() * availableDistractors.length);
              const randomDistractor = availableDistractors[randomIndex];
              // Check distinctness again just in case
              if (!distractors.includes(randomDistractor)) {
                distractors.push(randomDistractor);
                // Remove from pool to avoid dupes
                availableDistractors.splice(randomIndex, 1);
              }
            }

            const options = shuffleArray([correctOption, ...distractors]);

            return { correctOption, options };
          };

          const initAudio = () => {
            if (!audioContext) {
              const AudioContext = window.AudioContext || window.webkitAudioContext;
              if (AudioContext) {
                audioContext = new AudioContext();
              }
            }
            if (audioContext && audioContext.state === "suspended") {
              audioContext.resume();
            }
          };

          // Timer Logic
          const startTimer = () => {
            if (gameMode.value !== "blitz") return;

            clearInterval(timerInterval.value);
            timeLeft.value = BLITZ_TIME;

            timerInterval.value = setInterval(() => {
              const oldTime = Math.ceil(timeLeft.value);
              timeLeft.value -= 0.05; // Update every 50ms
              const newTime = Math.ceil(timeLeft.value);

              // Ticking sound for last 3 seconds (when second changes)
              if (newTime <= 3 && newTime > 0 && newTime < oldTime) {
                playSound("tick");
              }

              if (timeLeft.value <= 0) {
                timeLeft.value = 0;
                clearInterval(timerInterval.value);
                handleTimeUp();
              }
            }, 50);
          };

          const handleTimeUp = () => {
            if (feedback.value !== null) return;

            wrongAnswers.value.push({
              question: currentQuestion.value,
              userAnswer: null,
              type: "timeout",
            });

            feedback.value = "timeout";
            lastFeedback.value = "timeout";
            lives.value = 0; // Instant death in blitz
            streak.value = 0;

            playSound("incorrect");
          };

          const initGame = (mode = "normal") => {
            initAudio();
            gameMode.value = mode;
            score.value = 0;
            lives.value = mode === "blitz" ? 1 : 3;
            streak.value = 0;
            wrongAnswers.value = [];
            showMistakesModal.value = false;
            hasCelebratedHighScore.value = false;

            // Filter Countries
            let filteredCountries = COUNTRIES;
            if (selectedRegion.value !== "World") {
              filteredCountries = COUNTRIES.filter((c) => c.continent === selectedRegion.value);
            }

            queue.value = shuffleArray(filteredCountries);
            currentIndex.value = 0;
            selectedOption.value = null;
            feedback.value = null;
            lastFeedback.value = null;
            currentQuestion.value = generateQuestion();
            screen.value = "playing";
            userAnswer.value = "";

            if (mode === "blitz") {
              startTimer();
            }
          };

          // Audio Logic
          const playSound = (type) => {
            if (!soundEnabled.value) return;
            if (!audioContext) return;

            const ctx = audioContext;
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();

            osc.connect(gain);
            gain.connect(ctx.destination);

            if (type === "correct") {
              // High pitched "ding"
              osc.type = "sine";
              osc.frequency.setValueAtTime(523.25, ctx.currentTime); // C5
              osc.frequency.exponentialRampToValueAtTime(1046.5, ctx.currentTime + 0.1); // C6
              gain.gain.setValueAtTime(0.3, ctx.currentTime);
              gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
              osc.start(ctx.currentTime);
              osc.stop(ctx.currentTime + 0.3);
            } else if (type === "incorrect") {
              // Low pitched "buzz"
              osc.type = "sawtooth";
              osc.frequency.setValueAtTime(150, ctx.currentTime);
              osc.frequency.linearRampToValueAtTime(100, ctx.currentTime + 0.2);
              gain.gain.setValueAtTime(0.3, ctx.currentTime);
              gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
              osc.start(ctx.currentTime);
              osc.stop(ctx.currentTime + 0.3);
            } else if (type === "tick") {
              // Short woodblock-like tick
              osc.type = "sine";
              osc.frequency.setValueAtTime(800, ctx.currentTime);
              gain.gain.setValueAtTime(0.1, ctx.currentTime);
              gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.05);
              osc.start(ctx.currentTime);
              osc.stop(ctx.currentTime + 0.05);
            }
          };

          // Confetti Logic
          const triggerConfetti = () => {
            confetti({
              particleCount: 100,
              spread: 70,
              origin: { y: 0.6 },
            });
          };

          const triggerEmojiRain = () => {
            const emojis = ["üåç", "üåé", "üåè", "üó∫Ô∏è", "üö©", "üéå", "üè≥Ô∏è"];
            const end = Date.now() + 1000;

            (function frame() {
              confetti({
                particleCount: 3,
                angle: 60,
                spread: 55,
                origin: { x: 0 },
                shapes: ["circle"],
                scalar: 2,
                contents: emojis,
              });
              confetti({
                particleCount: 3,
                angle: 120,
                spread: 55,
                origin: { x: 1 },
                shapes: ["circle"],
                scalar: 2,
                contents: emojis,
              });

              if (Date.now() < end) {
                requestAnimationFrame(frame);
              }
            })();
          };

          const triggerFireworks = () => {
            const duration = 1000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            const randomInRange = (min, max) => Math.random() * (max - min) + min;

            const interval = setInterval(function () {
              const timeLeft = animationEnd - Date.now();

              if (timeLeft <= 0) {
                return clearInterval(interval);
              }

              const particleCount = 50 * (timeLeft / duration);
              confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } });
              confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } });
            }, 250);
          };

          const triggerSchoolPride = () => {
            const end = Date.now() + 1000;
            const colors = ["#bb0000", "#ffffff"];

            (function frame() {
              confetti({
                particleCount: 2,
                angle: 60,
                spread: 55,
                origin: { x: 0 },
                colors: colors,
              });
              confetti({
                particleCount: 2,
                angle: 120,
                spread: 55,
                origin: { x: 1 },
                colors: colors,
              });

              if (Date.now() < end) {
                requestAnimationFrame(frame);
              }
            })();
          };

          const triggerPride = () => {
            const colors = ["#FF0018", "#FFA52C", "#FFFF41", "#008018", "#0000F9", "#86007D"];
            confetti({
              particleCount: 150,
              spread: 100,
              origin: { y: 0.6 },
              colors: colors,
              disableForReducedMotion: true,
            });
          };

          const triggerRealFireworks = async () => {
            try {
              await loadScript("https://cdn.jsdelivr.net/npm/fireworks-js@2.10.8/dist/index.umd.js");

              if (!fireworksInstance && fireworksContainer.value) {
                const Fireworks = window.Fireworks.default || window.Fireworks;
                fireworksInstance = new Fireworks(fireworksContainer.value, {
                  hue: { min: 0, max: 360 },
                  delay: { min: 30, max: 60 },
                  rocketsPoint: { min: 50, max: 50 },
                  speed: 2,
                  acceleration: 1.05,
                  friction: 0.98,
                  gravity: 1.5,
                  particles: 50,
                  trace: 3,
                  explosion: 5,
                  autoresize: true,
                  brightness: { min: 50, max: 80, decay: { min: 0.015, max: 0.03 } },
                  boundaries: {
                    top: 50,
                    bottom: fireworksContainer.value.clientHeight,
                    left: 50,
                    right: fireworksContainer.value.clientWidth,
                  },
                });
              }

              if (fireworksInstance) {
                fireworksInstance.start();
                setTimeout(() => {
                  fireworksInstance.stop();
                }, 3000);
              }
            } catch (e) {
              console.error("Failed to load fireworks", e);
              triggerConfetti(); // Fallback
            }
          };

          const triggerCelebration = () => {
            const celebrations = [
              triggerConfetti,
              triggerFireworks,
              triggerSchoolPride,
              triggerPride,
              triggerRealFireworks,
            ];
            const randomCelebration = celebrations[Math.floor(Math.random() * celebrations.length)];
            randomCelebration();
          };

          const handleAnswer = (option, event = null) => {
            if (feedback.value !== null) return; // Already answered

            // Clear mindfuck effect to reveal the flag
            if (gameMode.value === "mindfuck") {
              currentEffect.value = null;
            }

            clearInterval(timerInterval.value);

            let isCorrect = false;
            let isPerfect = false;
            const correctCode = currentQuestion.value.correctOption.code;

            if (gameMode.value === "hard") {
              // Hard Mode Logic
              const input = (typeof option === "string" ? option : userAnswer.value).trim().toLowerCase();
              const correctName = currentQuestion.value.correctOption.name.toLowerCase();

              const maxDistance = correctName.length <= 4 ? 1 : 2;
              const dist = levenshtein(input, correctName);

              if (dist === 0) {
                isCorrect = true;
                isPerfect = true;
              } else if (dist <= maxDistance) {
                isCorrect = true;
              }
            } else {
              // Standard Logic
              selectedOption.value = option;
              isCorrect = option.code === correctCode;
            }

            if (isCorrect) {
              feedback.value = "correct";
              lastFeedback.value = "correct";
              let points = 10 + streak.value * 2;

              if (gameMode.value === "blitz") {
                // Speed bonus: more points for answering faster
                // Up to 50 extra points (10 per second remaining)
                points += Math.ceil(timeLeft.value * 10);
              } else if (gameMode.value === "hard") {
                points += 10; // Hard mode base bonus
                if (isPerfect) points += 20; // Perfect spelling bonus
              } else if (gameMode.value === "mindfuck") {
                points += 5; // Mindfuck bonus
              }

              score.value += points;
              streak.value += 1;

              // Visual Effects
              if (event) {
                // Use click coordinates
                triggerFloatingPoints(event.clientX, event.clientY, points);
              } else {
                // Keyboard or default: Center of screen
                const appRect = document.getElementById("app").getBoundingClientRect();
                triggerFloatingPoints(appRect.left + appRect.width / 2, appRect.top + appRect.height / 2, points);
              }

              // Sound & Haptics
              playSound("correct");

              // Update High Score
              let beatHighScore = false;
              // Only confetti if we actually beat a *previous* high score that was > 0
              if (score.value > highScore.value) {
                const previousHigh = highScore.value;
                highScore.value = score.value;
                localStorage.setItem("flag-master-highscore", highScore.value);

                if (previousHigh > 0 && !hasCelebratedHighScore.value) {
                  beatHighScore = true;
                  hasCelebratedHighScore.value = true;
                }
              }

              // Update Passport
              if (!collectedFlags.value[correctCode]) {
                collectedFlags.value[correctCode] = 0;
              }
              collectedFlags.value[correctCode]++;
              localStorage.setItem("flag-master-collection", JSON.stringify(collectedFlags.value));

              if (beatHighScore) {
                // Confetti for NEW High Score (First time only this run, if beating a non-zero record)
                triggerCelebration();
              } else if (streak.value > 0 && streak.value % 5 === 0) {
                // Confetti every 5 streak
                triggerCelebration();
              } else if (isPerfect && gameMode.value === "hard") {
                triggerConfetti();
              }

              if (gameMode.value === "blitz") {
                autoAdvanceTimer.value = setTimeout(() => {
                  nextQuestion();
                }, 600);
              } else if (autoContinue.value) {
                // Auto-continue for correct answers when setting is enabled (except blitz which already has it)
                autoAdvanceTimer.value = setTimeout(() => {
                  nextQuestion();
                }, 0);
              }
            } else {
              feedback.value = "incorrect";
              lastFeedback.value = "incorrect";
              lives.value -= 1;
              streak.value = 0;

              wrongAnswers.value.push({
                question: currentQuestion.value,
                userAnswer: gameMode.value === "hard" ? userAnswer.value : option,
                type: "incorrect",
              });

              // Visual Effects
              triggerShake();

              // Sound & Haptics
              playSound("incorrect");
            }
          };

          const nextQuestion = () => {
            if (autoAdvanceTimer.value) {
              clearTimeout(autoAdvanceTimer.value);
              autoAdvanceTimer.value = null;
            }

            if (lives.value <= 0) {
              screen.value = "end";
            } else if (currentIndex.value >= queue.value.length - 1) {
              screen.value = "end";
            } else {
              currentIndex.value += 1;
              currentQuestion.value = generateQuestion();
              selectedOption.value = null;
              feedback.value = null;
              userAnswer.value = "";
              if (gameMode.value === "blitz") {
                startTimer();
              }
            }
          };

          const quitGame = () => {
            clearInterval(timerInterval.value);
            if (autoAdvanceTimer.value) clearTimeout(autoAdvanceTimer.value);

            // Reset critical state
            screen.value = "start";
            score.value = 0;
            streak.value = 0;
            lives.value = 3;
            currentIndex.value = 0;
            feedback.value = null;
            userAnswer.value = "";
          };

          const handleImageError = (e) => {
            e.target.onerror = null;
            e.target.src =
              "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";
          };

          const shareScore = async () => {
            const modeMap = {
              normal: "Normal",
              reverse: "Reverse",
              blitz: "Blitz",
              hard: "Hard",
              capitals: "Capitals",
              description: "Description",
              mindfuck: "Mindfuck",
            };
            const modeName = modeMap[gameMode.value] || "Normal";
            const text = `I scored ${score.value} points in Flag Master (${modeName} Mode)! üè≥Ô∏è Can you beat me?`;
            const url = window.location.href;

            if (navigator.share) {
              try {
                await navigator.share({
                  title: `üèÜ Flag Master Score: ${score.value}`,
                  text: text,
                  url: url,
                });
              } catch (err) {
                console.log("Share cancelled or failed", err);
              }
            } else {
              try {
                await navigator.clipboard.writeText(`${text} ${url}`);
                alert("Score copied to clipboard!");
              } catch (err) {
                console.error("Failed to copy: ", err);
              }
            }
          };

          // Computed
          const progress = computed(() => (currentIndex.value / queue.value.length) * 100);
          const isCorrect = computed(() => {
            if (feedback.value !== null) {
              return feedback.value === "correct";
            }
            return lastFeedback.value === "correct";
          });
          const totalCountries = computed(() => COUNTRIES.length);

          // Dynamic Classes
          const getOptionClass = (option) => {
            let classes = "";
            if (feedback.value !== null) {
              if (option.code === currentQuestion.value.correctOption.code) {
                classes = "bg-green-100 border-green-500 text-green-700";
              } else if (selectedOption.value && selectedOption.value.code === option.code) {
                classes = "bg-red-100 border-red-500 text-red-700";
              } else {
                classes = "bg-white border-gray-200 opacity-50 text-gray-400";
              }
            } else {
              if (selectedOption.value === option) {
                classes = "bg-blue-100 border-blue-500 text-blue-700";
              } else {
                classes =
                  "bg-white border-gray-200 hover:bg-gray-50 text-gray-700 active:border-b-2 active:translate-y-[2px]";
              }
            }
            return classes;
          };

          const progressBarClass = computed(() => {
            if (streak.value < 3) {
              return "bg-green-500";
            } else if (streak.value < 6) {
              // Warming up: Yellow to Orange
              return "bg-gradient-to-r from-yellow-400 to-orange-500";
            } else if (streak.value < 10) {
              // Hot: Orange to Red
              return "bg-gradient-to-r from-orange-500 to-red-600 shadow-[0_0_15px_rgba(220,38,38,0.5)]";
            } else {
              // Supernova: Red -> Pink -> Purple (Animated Pulse)
              return "bg-gradient-to-r from-red-500 via-pink-500 to-purple-600 animate-pulse shadow-[0_0_20px_rgba(236,72,153,0.6)]";
            }
          });

          const getNumberClass = (option) => {
            if (feedback.value !== null) {
              if (option.code === currentQuestion.value.correctOption.code) {
                return "border-green-500 text-green-700 bg-green-200";
              } else if (selectedOption.value && selectedOption.value.code === option.code) {
                return "border-red-500 text-red-700 bg-red-200";
              } else {
                return "border-gray-200 bg-white";
              }
            } else {
              if (selectedOption.value === option) {
                return "border-blue-500 text-blue-700 bg-blue-200";
              } else {
                return "border-gray-200 text-gray-400 bg-white";
              }
            }
          };

          const bottomSheetClasses = computed(() => {
            let classes = isCorrect.value ? "bg-green-100 border-green-200" : "bg-red-100 border-red-200";
            if (feedback.value === null) {
              classes += " translate-y-full";
            } else {
              classes += " translate-y-0";
            }
            return classes;
          });

          // Keyboard Events
          const handleKeydown = (e) => {
            if (screen.value === "playing") {
              if (["1", "2", "3", "4"].includes(e.key) && feedback.value === null) {
                const index = parseInt(e.key) - 1;
                if (currentQuestion.value && currentQuestion.value.options[index]) {
                  handleAnswer(currentQuestion.value.options[index]);
                }
              }
              if (e.key === "Enter" && feedback.value !== null) {
                nextQuestion();
              }
            } else if (screen.value === "start") {
              if (e.key === "Enter") {
                initGame("normal");
              }
            } else if (screen.value === "end") {
              if (e.key === "Enter") {
                screen.value = "start";
              }
            }
          };

          // Prevent Zoom
          const handleGestureStart = (e) => {
            e.preventDefault();
          };

          onMounted(() => {
            window.addEventListener("keydown", handleKeydown);
            document.addEventListener("gesturestart", handleGestureStart);

            // Load High Score
            const savedScore = localStorage.getItem("flag-master-highscore");
            if (savedScore) {
              highScore.value = parseInt(savedScore);
            }

            // Load Passport
            const savedCollection = localStorage.getItem("flag-master-collection");
            if (savedCollection) {
              try {
                collectedFlags.value = JSON.parse(savedCollection);
              } catch (e) {
                console.error("Failed to load collection", e);
                collectedFlags.value = {};
              }
            }

            // Load Settings
            const savedSettings = localStorage.getItem("flag-master-settings");
            if (savedSettings) {
              try {
                const parsed = JSON.parse(savedSettings);
                if (parsed.sound !== undefined) soundEnabled.value = parsed.sound;
                if (parsed.autoContinue !== undefined) autoContinue.value = parsed.autoContinue;
              } catch (e) {}
            }

            // Watchers to save settings
            Vue.watch(soundEnabled, () => {
              localStorage.setItem(
                "flag-master-settings",
                JSON.stringify({
                  sound: soundEnabled.value,
                  autoContinue: autoContinue.value,
                })
              );
            });

            Vue.watch(autoContinue, () => {
              localStorage.setItem(
                "flag-master-settings",
                JSON.stringify({
                  sound: soundEnabled.value,
                  autoContinue: autoContinue.value,
                })
              );
            });
          });

          onUnmounted(() => {
            clearInterval(timerInterval.value);
            if (autoAdvanceTimer.value) clearTimeout(autoAdvanceTimer.value);
            window.removeEventListener("keydown", handleKeydown);
            document.removeEventListener("gesturestart", handleGestureStart);
          });

          return {
            screen,
            gameMode,
            score,
            lives,
            highScore,
            currentIndex,
            currentQuestion,
            selectedOption,
            feedback,
            userAnswer,
            initGame,
            handleAnswer,
            nextQuestion,
            quitGame,
            handleImageError,
            shareScore,
            progress,
            isCorrect,
            totalCountries,
            getOptionClass,
            getNumberClass,
            bottomSheetClasses,
            timeLeft,
            showRegionSelector,
            selectedRegion,
            continents,
            collectedFlags,
            soundEnabled,
            autoContinue,
            showSettings,
            fireworksContainer,
            floatingPoints,
            shakeActive,
            streak,
            wrongAnswers,
            showMistakesModal,
            progressBarClass,
            icons: ICONS,
            queue,
            shakeActive,
            gameModes,
            currentEffect,
            getRegionCount: (region) => {
              const regionCountries = COUNTRIES.filter((c) => c.continent === region);
              const collected = regionCountries.filter((c) => collectedFlags.value[c.code]);
              return Math.round((collected.length / regionCountries.length) * 100);
            },
            getRegionProgress: (region) => {
              const regionCountries = COUNTRIES.filter((c) => c.continent === region);
              const collected = regionCountries.filter((c) => collectedFlags.value[c.code]);
              return (collected.length / regionCountries.length) * 100;
            },
          };
        },
      }).mount("#app");
    </script>
  </body>
</html>
